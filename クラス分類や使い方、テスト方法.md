# 各クラス分類の関係性と利点

## クラス分類の関係性

```
[ユーザーインターフェース層 (UI/Presentation)]
              ↓↑ DTO
[ビジネスロジック層 (Business Logic)]
              ↓↑ DTO/Entity
[データアクセス層 (DAO/Repository)]
              ↓↑
        [データベース]
```

### 各層の役割

**1. DAO (Data Access Object)**
- データベースとの直接的なやり取りを担当
- CRUD操作（作成、読取、更新、削除）を実装
- SQL文やストアドプロシージャの実行

**2. DTO (Data Transfer Object)**
- 層間でデータを運ぶためのオブジェクト
- ビジネスロジックを持たない純粋なデータコンテナ
- 必要なデータのみを含む

**3. ビジネスロジック層**
- アプリケーションの業務ルールを実装
- データの検証、計算、変換などを実行
- DAOを呼び出してデータを取得・保存

**4. ユーザーインターフェース層**
- ユーザーとのやり取りを管理
- 画面表示、イベント処理
- ビジネスロジック層を呼び出す

## クラス分けの利点

**保守性の向上**
- 各層が独立しているため、修正の影響範囲が限定される
- バグの特定が容易

**再利用性**
- ビジネスロジックを異なるUI（WinForms、Web、モバイル）で共有可能
- DAOを複数の機能で使い回せる

**テスタビリティ**
- 各層を独立してテスト可能
- モックオブジェクトを使用した単体テストが容易

**並行開発**
- 複数の開発者が異なる層を同時に開発可能

**変更への柔軟性**
- データベース変更時はDAO層のみ修正
- UI変更時はプレゼンテーション層のみ修正

---

# VB.NET (.NET Framework 4.8) WinFormsサンプル

従業員管理システムのサンプルを作成します。

## 1. DTO (Data Transfer Object)

```vb
' EmployeeDto.vb
Public Class EmployeeDto
    Public Property EmployeeId As Integer
    Public Property FirstName As String
    Public Property LastName As String
    Public Property Email As String
    Public Property Department As String
    Public Property Salary As Decimal
    Public Property HireDate As DateTime
    
    Public ReadOnly Property FullName As String
        Get
            Return $"{FirstName} {LastName}"
        End Get
    End Property
End Class
```

## 2. DAO (Data Access Object)

```vb
' EmployeeDao.vb
Imports System.Data.SqlClient
Imports System.Configuration

Public Class EmployeeDao
    Private ReadOnly _connectionString As String
    
    Public Sub New()
        _connectionString = ConfigurationManager.ConnectionStrings("DefaultConnection").ConnectionString
    End Sub
    
    ''' <summary>
    ''' 全従業員を取得
    ''' </summary>
    Public Function GetAllEmployees() As List(Of EmployeeDto)
        Dim employees As New List(Of EmployeeDto)
        
        Using conn As New SqlConnection(_connectionString)
            Dim sql As String = "SELECT EmployeeId, FirstName, LastName, Email, Department, Salary, HireDate FROM Employees"
            Using cmd As New SqlCommand(sql, conn)
                conn.Open()
                Using reader As SqlDataReader = cmd.ExecuteReader()
                    While reader.Read()
                        employees.Add(New EmployeeDto With {
                            .EmployeeId = reader.GetInt32(0),
                            .FirstName = reader.GetString(1),
                            .LastName = reader.GetString(2),
                            .Email = reader.GetString(3),
                            .Department = reader.GetString(4),
                            .Salary = reader.GetDecimal(5),
                            .HireDate = reader.GetDateTime(6)
                        })
                    End While
                End Using
            End Using
        End Using
        
        Return employees
    End Function
    
    ''' <summary>
    ''' IDで従業員を取得
    ''' </summary>
    Public Function GetEmployeeById(employeeId As Integer) As EmployeeDto
        Using conn As New SqlConnection(_connectionString)
            Dim sql As String = "SELECT EmployeeId, FirstName, LastName, Email, Department, Salary, HireDate FROM Employees WHERE EmployeeId = @EmployeeId"
            Using cmd As New SqlCommand(sql, conn)
                cmd.Parameters.AddWithValue("@EmployeeId", employeeId)
                conn.Open()
                Using reader As SqlDataReader = cmd.ExecuteReader()
                    If reader.Read() Then
                        Return New EmployeeDto With {
                            .EmployeeId = reader.GetInt32(0),
                            .FirstName = reader.GetString(1),
                            .LastName = reader.GetString(2),
                            .Email = reader.GetString(3),
                            .Department = reader.GetString(4),
                            .Salary = reader.GetDecimal(5),
                            .HireDate = reader.GetDateTime(6)
                        }
                    End If
                End Using
            End Using
        End Using
        Return Nothing
    End Function
    
    ''' <summary>
    ''' 従業員を追加
    ''' </summary>
    Public Function InsertEmployee(employee As EmployeeDto) As Integer
        Using conn As New SqlConnection(_connectionString)
            Dim sql As String = "INSERT INTO Employees (FirstName, LastName, Email, Department, Salary, HireDate) " &
                               "VALUES (@FirstName, @LastName, @Email, @Department, @Salary, @HireDate); " &
                               "SELECT CAST(SCOPE_IDENTITY() as int)"
            Using cmd As New SqlCommand(sql, conn)
                cmd.Parameters.AddWithValue("@FirstName", employee.FirstName)
                cmd.Parameters.AddWithValue("@LastName", employee.LastName)
                cmd.Parameters.AddWithValue("@Email", employee.Email)
                cmd.Parameters.AddWithValue("@Department", employee.Department)
                cmd.Parameters.AddWithValue("@Salary", employee.Salary)
                cmd.Parameters.AddWithValue("@HireDate", employee.HireDate)
                
                conn.Open()
                Return CInt(cmd.ExecuteScalar())
            End Using
        End Using
    End Function
    
    ''' <summary>
    ''' 従業員を更新
    ''' </summary>
    Public Function UpdateEmployee(employee As EmployeeDto) As Boolean
        Using conn As New SqlConnection(_connectionString)
            Dim sql As String = "UPDATE Employees SET FirstName = @FirstName, LastName = @LastName, " &
                               "Email = @Email, Department = @Department, Salary = @Salary, HireDate = @HireDate " &
                               "WHERE EmployeeId = @EmployeeId"
            Using cmd As New SqlCommand(sql, conn)
                cmd.Parameters.AddWithValue("@EmployeeId", employee.EmployeeId)
                cmd.Parameters.AddWithValue("@FirstName", employee.FirstName)
                cmd.Parameters.AddWithValue("@LastName", employee.LastName)
                cmd.Parameters.AddWithValue("@Email", employee.Email)
                cmd.Parameters.AddWithValue("@Department", employee.Department)
                cmd.Parameters.AddWithValue("@Salary", employee.Salary)
                cmd.Parameters.AddWithValue("@HireDate", employee.HireDate)
                
                conn.Open()
                Return cmd.ExecuteNonQuery() > 0
            End Using
        End Using
    End Function
    
    ''' <summary>
    ''' 従業員を削除
    ''' </summary>
    Public Function DeleteEmployee(employeeId As Integer) As Boolean
        Using conn As New SqlConnection(_connectionString)
            Dim sql As String = "DELETE FROM Employees WHERE EmployeeId = @EmployeeId"
            Using cmd As New SqlCommand(sql, conn)
                cmd.Parameters.AddWithValue("@EmployeeId", employeeId)
                conn.Open()
                Return cmd.ExecuteNonQuery() > 0
            End Using
        End Using
    End Function
End Class
```

## 3. ビジネスロジック層

```vb
' EmployeeService.vb
Public Class EmployeeService
    Private ReadOnly _employeeDao As EmployeeDao
    
    Public Sub New()
        _employeeDao = New EmployeeDao()
    End Sub
    
    ''' <summary>
    ''' 全従業員を取得
    ''' </summary>
    Public Function GetAllEmployees() As List(Of EmployeeDto)
        Try
            Return _employeeDao.GetAllEmployees()
        Catch ex As Exception
            Throw New ApplicationException("従業員リストの取得に失敗しました。", ex)
        End Try
    End Function
    
    ''' <summary>
    ''' 部署でフィルタリング
    ''' </summary>
    Public Function GetEmployeesByDepartment(department As String) As List(Of EmployeeDto)
        Try
            Dim allEmployees = _employeeDao.GetAllEmployees()
            Return allEmployees.Where(Function(e) e.Department = department).ToList()
        Catch ex As Exception
            Throw New ApplicationException("従業員の検索に失敗しました。", ex)
        End Try
    End Function
    
    ''' <summary>
    ''' 従業員を追加（検証付き）
    ''' </summary>
    Public Function AddEmployee(employee As EmployeeDto) As Integer
        ' ビジネスルールの検証
        ValidateEmployee(employee)
        
        Try
            Return _employeeDao.InsertEmployee(employee)
        Catch ex As Exception
            Throw New ApplicationException("従業員の追加に失敗しました。", ex)
        End Try
    End Function
    
    ''' <summary>
    ''' 従業員を更新（検証付き）
    ''' </summary>
    Public Function UpdateEmployee(employee As EmployeeDto) As Boolean
        ValidateEmployee(employee)
        
        Try
            Return _employeeDao.UpdateEmployee(employee)
        Catch ex As Exception
            Throw New ApplicationException("従業員の更新に失敗しました。", ex)
        End Try
    End Function
    
    ''' <summary>
    ''' 従業員を削除
    ''' </summary>
    Public Function DeleteEmployee(employeeId As Integer) As Boolean
        Try
            Return _employeeDao.DeleteEmployee(employeeId)
        Catch ex As Exception
            Throw New ApplicationException("従業員の削除に失敗しました。", ex)
        End Try
    End Function
    
    ''' <summary>
    ''' 給与の平均を計算
    ''' </summary>
    Public Function CalculateAverageSalary() As Decimal
        Try
            Dim employees = _employeeDao.GetAllEmployees()
            If employees.Count = 0 Then Return 0
            Return employees.Average(Function(e) e.Salary)
        Catch ex As Exception
            Throw New ApplicationException("平均給与の計算に失敗しました。", ex)
        End Try
    End Function
    
    ''' <summary>
    ''' 従業員データの検証
    ''' </summary>
    Private Sub ValidateEmployee(employee As EmployeeDto)
        Dim errors As New List(Of String)
        
        If String.IsNullOrWhiteSpace(employee.FirstName) Then
            errors.Add("名前を入力してください。")
        End If
        
        If String.IsNullOrWhiteSpace(employee.LastName) Then
            errors.Add("苗字を入力してください。")
        End If
        
        If String.IsNullOrWhiteSpace(employee.Email) Then
            errors.Add("メールアドレスを入力してください。")
        ElseIf Not IsValidEmail(employee.Email) Then
            errors.Add("有効なメールアドレスを入力してください。")
        End If
        
        If String.IsNullOrWhiteSpace(employee.Department) Then
            errors.Add("部署を選択してください。")
        End If
        
        If employee.Salary <= 0 Then
            errors.Add("給与は0より大きい値を入力してください。")
        End If
        
        If employee.HireDate > DateTime.Now Then
            errors.Add("入社日は現在より前の日付を入力してください。")
        End If
        
        If errors.Count > 0 Then
            Throw New ValidationException(String.Join(vbCrLf, errors))
        End If
    End Sub
    
    ''' <summary>
    ''' メールアドレスの検証
    ''' </summary>
    Private Function IsValidEmail(email As String) As Boolean
        Try
            Dim addr = New System.Net.Mail.MailAddress(email)
            Return addr.Address = email
        Catch
            Return False
        End Try
    End Function
End Class

' カスタム例外クラス
Public Class ValidationException
    Inherits Exception
    
    Public Sub New(message As String)
        MyBase.New(message)
    End Sub
End Class
```

## 4. ユーザーインターフェース層 (WinForms)

```vb
' EmployeeListForm.vb
Public Class EmployeeListForm
    Private ReadOnly _employeeService As EmployeeService
    
    Public Sub New()
        InitializeComponent()
        _employeeService = New EmployeeService()
    End Sub
    
    Private Sub EmployeeListForm_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        ' DataGridViewの設定
        SetupDataGridView()
        
        ' 部署コンボボックスの設定
        SetupDepartmentComboBox()
        
        ' データの読み込み
        LoadEmployees()
    End Sub
    
    Private Sub SetupDataGridView()
        With dgvEmployees
            .AutoGenerateColumns = False
            .SelectionMode = DataGridViewSelectionMode.FullRowSelect
            .MultiSelect = False
            .ReadOnly = True
            
            ' 列の定義
            .Columns.Add(New DataGridViewTextBoxColumn With {
                .Name = "EmployeeId",
                .HeaderText = "ID",
                .DataPropertyName = "EmployeeId",
                .Width = 50
            })
            
            .Columns.Add(New DataGridViewTextBoxColumn With {
                .Name = "FullName",
                .HeaderText = "氏名",
                .DataPropertyName = "FullName",
                .Width = 150
            })
            
            .Columns.Add(New DataGridViewTextBoxColumn With {
                .Name = "Email",
                .HeaderText = "メールアドレス",
                .DataPropertyName = "Email",
                .Width = 200
            })
            
            .Columns.Add(New DataGridViewTextBoxColumn With {
                .Name = "Department",
                .HeaderText = "部署",
                .DataPropertyName = "Department",
                .Width = 100
            })
            
            .Columns.Add(New DataGridViewTextBoxColumn With {
                .Name = "Salary",
                .HeaderText = "給与",
                .DataPropertyName = "Salary",
                .Width = 100,
                .DefaultCellStyle = New DataGridViewCellStyle With {.Format = "C0"}
            })
            
            .Columns.Add(New DataGridViewTextBoxColumn With {
                .Name = "HireDate",
                .HeaderText = "入社日",
                .DataPropertyName = "HireDate",
                .Width = 100,
                .DefaultCellStyle = New DataGridViewCellStyle With {.Format = "yyyy/MM/dd"}
            })
        End With
    End Sub
    
    Private Sub SetupDepartmentComboBox()
        With cmbDepartment
            .Items.Clear()
            .Items.Add("すべて")
            .Items.Add("営業部")
            .Items.Add("開発部")
            .Items.Add("総務部")
            .Items.Add("人事部")
            .SelectedIndex = 0
        End With
    End Sub
    
    Private Sub LoadEmployees()
        Try
            Cursor = Cursors.WaitCursor
            
            Dim employees As List(Of EmployeeDto)
            
            If cmbDepartment.SelectedIndex = 0 Then
                employees = _employeeService.GetAllEmployees()
            Else
                employees = _employeeService.GetEmployeesByDepartment(cmbDepartment.SelectedItem.ToString())
            End If
            
            dgvEmployees.DataSource = employees
            
            ' 平均給与を表示
            Dim avgSalary = _employeeService.CalculateAverageSalary()
            lblAverageSalary.Text = $"平均給与: {avgSalary:C0}"
            
        Catch ex As Exception
            MessageBox.Show($"データの読み込みに失敗しました。{vbCrLf}{ex.Message}", 
                           "エラー", MessageBoxButtons.OK, MessageBoxIcon.Error)
        Finally
            Cursor = Cursors.Default
        End Try
    End Sub
    
    Private Sub btnAdd_Click(sender As Object, e As EventArgs) Handles btnAdd.Click
        Using frm As New EmployeeEditForm()
            If frm.ShowDialog() = DialogResult.OK Then
                LoadEmployees()
                MessageBox.Show("従業員を追加しました。", "成功", MessageBoxButtons.OK, MessageBoxIcon.Information)
            End If
        End Using
    End Sub
    
    Private Sub btnEdit_Click(sender As Object, e As EventArgs) Handles btnEdit.Click
        If dgvEmployees.SelectedRows.Count = 0 Then
            MessageBox.Show("編集する従業員を選択してください。", "確認", MessageBoxButtons.OK, MessageBoxIcon.Warning)
            Return
        End If
        
        Dim employee = CType(dgvEmployees.SelectedRows(0).DataBoundItem, EmployeeDto)
        
        Using frm As New EmployeeEditForm(employee)
            If frm.ShowDialog() = DialogResult.OK Then
                LoadEmployees()
                MessageBox.Show("従業員情報を更新しました。", "成功", MessageBoxButtons.OK, MessageBoxIcon.Information)
            End If
        End Using
    End Sub
    
    Private Sub btnDelete_Click(sender As Object, e As EventArgs) Handles btnDelete.Click
        If dgvEmployees.SelectedRows.Count = 0 Then
            MessageBox.Show("削除する従業員を選択してください。", "確認", MessageBoxButtons.OK, MessageBoxIcon.Warning)
            Return
        End If
        
        Dim employee = CType(dgvEmployees.SelectedRows(0).DataBoundItem, EmployeeDto)
        
        Dim result = MessageBox.Show($"{employee.FullName}を削除してもよろしいですか?", 
                                     "削除確認", MessageBoxButtons.YesNo, MessageBoxIcon.Question)
        
        If result = DialogResult.Yes Then
            Try
                If _employeeService.DeleteEmployee(employee.EmployeeId) Then
                    LoadEmployees()
                    MessageBox.Show("従業員を削除しました。", "成功", MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
            Catch ex As Exception
                MessageBox.Show($"削除に失敗しました。{vbCrLf}{ex.Message}", 
                               "エラー", MessageBoxButtons.OK, MessageBoxIcon.Error)
            End Try
        End If
    End Sub
    
    Private Sub cmbDepartment_SelectedIndexChanged(sender As Object, e As EventArgs) Handles cmbDepartment.SelectedIndexChanged
        LoadEmployees()
    End Sub
    
    Private Sub btnRefresh_Click(sender As Object, e As EventArgs) Handles btnRefresh.Click
        LoadEmployees()
    End Sub
End Class
```

```vb
' EmployeeEditForm.vb
Public Class EmployeeEditForm
    Private ReadOnly _employeeService As EmployeeService
    Private _employee As EmployeeDto
    Private _isEditMode As Boolean
    
    ' 新規追加用コンストラクタ
    Public Sub New()
        InitializeComponent()
        _employeeService = New EmployeeService()
        _isEditMode = False
        _employee = New EmployeeDto()
    End Sub
    
    ' 編集用コンストラクタ
    Public Sub New(employee As EmployeeDto)
        Me.New()
        _employee = employee
        _isEditMode = True
    End Sub
    
    Private Sub EmployeeEditForm_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        SetupDepartmentComboBox()
        
        If _isEditMode Then
            Me.Text = "従業員編集"
            LoadEmployeeData()
        Else
            Me.Text = "従業員追加"
            dtpHireDate.Value = DateTime.Now
        End If
    End Sub
    
    Private Sub SetupDepartmentComboBox()
        With cmbDepartment
            .Items.Clear()
            .Items.Add("営業部")
            .Items.Add("開発部")
            .Items.Add("総務部")
            .Items.Add("人事部")
        End With
    End Sub
    
    Private Sub LoadEmployeeData()
        txtFirstName.Text = _employee.FirstName
        txtLastName.Text = _employee.LastName
        txtEmail.Text = _employee.Email
        cmbDepartment.SelectedItem = _employee.Department
        nudSalary.Value = _employee.Salary
        dtpHireDate.Value = _employee.HireDate
    End Sub
    
    Private Sub btnSave_Click(sender As Object, e As EventArgs) Handles btnSave.Click
        Try
            ' DTOにデータを設定
            _employee.FirstName = txtFirstName.Text.Trim()
            _employee.LastName = txtLastName.Text.Trim()
            _employee.Email = txtEmail.Text.Trim()
            _employee.Department = cmbDepartment.SelectedItem?.ToString()
            _employee.Salary = nudSalary.Value
            _employee.HireDate = dtpHireDate.Value
            
            ' 保存処理
            If _isEditMode Then
                _employeeService.UpdateEmployee(_employee)
            Else
                _employeeService.AddEmployee(_employee)
            End If
            
            Me.DialogResult = DialogResult.OK
            Me.Close()
            
        Catch ex As ValidationException
            MessageBox.Show(ex.Message, "入力エラー", MessageBoxButtons.OK, MessageBoxIcon.Warning)
        Catch ex As Exception
            MessageBox.Show($"保存に失敗しました。{vbCrLf}{ex.Message}", 
                           "エラー", MessageBoxButtons.OK, MessageBoxIcon.Error)
        End Try
    End Sub
    
    Private Sub btnCancel_Click(sender As Object, e As EventArgs) Handles btnCancel.Click
        Me.DialogResult = DialogResult.Cancel
        Me.Close()
    End Sub
End Class
```

## App.config

```xml
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <connectionStrings>
    <add name="DefaultConnection" 
         connectionString="Server=localhost;Database=EmployeeDB;Integrated Security=true;" 
         providerName="System.Data.SqlClient"/>
  </connectionStrings>
</configuration>
```

## データベーステーブル (SQL Server)

```sql
CREATE TABLE Employees (
    EmployeeId INT PRIMARY KEY IDENTITY(1,1),
    FirstName NVARCHAR(50) NOT NULL,
    LastName NVARCHAR(50) NOT NULL,
    Email NVARCHAR(100) NOT NULL,
    Department NVARCHAR(50) NOT NULL,
    Salary DECIMAL(18,2) NOT NULL,
    HireDate DATE NOT NULL
);
```

このサンプルでは、各層が明確に分離されており、保守性と拡張性の高いアプリケーション構造を実現しています。

# MSTestを使ったテストの書き方

VB.NETでMSTestを使用した各層のテストサンプルを紹介します。

## テストプロジェクトの構成

```
EmployeeManagement.Tests/
├── Unit/                    # 単体テスト（高速）
│   ├── ServiceTests/
│   └── ValidationTests/
├── Integration/            # 統合テスト（中速）
│   └── DaoTests/
└── TestUtilities/          # テスト用ユーティリティ
    ├── TestDatabase.vb
    └── TestDataBuilder.vb
```

## 1. テストユーティリティ

### テストデータベース管理クラス

```vb
' TestDatabase.vb
Imports System.Data.SqlClient
Imports System.Configuration

Public Class TestDatabase
    Private Shared ReadOnly _testConnectionString As String = 
        "Server=localhost;Database=EmployeeDB_Test;Integrated Security=true;"
    
    Public Shared ReadOnly Property ConnectionString As String
        Get
            Return _testConnectionString
        End Get
    End Property
    
    ''' <summary>
    ''' テストデータベースを初期化（テーブル作成）
    ''' </summary>
    Public Shared Sub Initialize()
        Using conn As New SqlConnection(_testConnectionString)
            conn.Open()
            
            ' 既存テーブルを削除
            Dim dropTableSql As String = "IF OBJECT_ID('Employees', 'U') IS NOT NULL DROP TABLE Employees"
            Using cmd As New SqlCommand(dropTableSql, conn)
                cmd.ExecuteNonQuery()
            End Using
            
            ' テーブルを作成
            Dim createTableSql As String = "
                CREATE TABLE Employees (
                    EmployeeId INT PRIMARY KEY IDENTITY(1,1),
                    FirstName NVARCHAR(50) NOT NULL,
                    LastName NVARCHAR(50) NOT NULL,
                    Email NVARCHAR(100) NOT NULL,
                    Department NVARCHAR(50) NOT NULL,
                    Salary DECIMAL(18,2) NOT NULL,
                    HireDate DATE NOT NULL
                )"
            Using cmd As New SqlCommand(createTableSql, conn)
                cmd.ExecuteNonQuery()
            End Using
        End Using
    End Sub
    
    ''' <summary>
    ''' テストデータベースをクリーンアップ（全データ削除）
    ''' </summary>
    Public Shared Sub Cleanup()
        Using conn As New SqlConnection(_testConnectionString)
            conn.Open()
            Dim sql As String = "DELETE FROM Employees; DBCC CHECKIDENT ('Employees', RESEED, 0)"
            Using cmd As New SqlCommand(sql, conn)
                cmd.ExecuteNonQuery()
            End Using
        End Using
    End Sub
    
    ''' <summary>
    ''' テストデータを挿入
    ''' </summary>
    Public Shared Function InsertTestEmployee(employee As EmployeeDto) As Integer
        Using conn As New SqlConnection(_testConnectionString)
            Dim sql As String = "
                INSERT INTO Employees (FirstName, LastName, Email, Department, Salary, HireDate) 
                VALUES (@FirstName, @LastName, @Email, @Department, @Salary, @HireDate);
                SELECT CAST(SCOPE_IDENTITY() as int)"
            
            Using cmd As New SqlCommand(sql, conn)
                cmd.Parameters.AddWithValue("@FirstName", employee.FirstName)
                cmd.Parameters.AddWithValue("@LastName", employee.LastName)
                cmd.Parameters.AddWithValue("@Email", employee.Email)
                cmd.Parameters.AddWithValue("@Department", employee.Department)
                cmd.Parameters.AddWithValue("@Salary", employee.Salary)
                cmd.Parameters.AddWithValue("@HireDate", employee.HireDate)
                
                conn.Open()
                Return CInt(cmd.ExecuteScalar())
            End Using
        End Using
    End Function
    
    ''' <summary>
    ''' レコード数を取得
    ''' </summary>
    Public Shared Function GetEmployeeCount() As Integer
        Using conn As New SqlConnection(_testConnectionString)
            Dim sql As String = "SELECT COUNT(*) FROM Employees"
            Using cmd As New SqlCommand(sql, conn)
                conn.Open()
                Return CInt(cmd.ExecuteScalar())
            End Using
        End Using
    End Function
End Class
```

### テストデータビルダー

```vb
' TestDataBuilder.vb
Public Class TestDataBuilder
    Private _employee As EmployeeDto
    
    Public Sub New()
        ' デフォルト値
        _employee = New EmployeeDto With {
            .FirstName = "太郎",
            .LastName = "山田",
            .Email = "taro.yamada@example.com",
            .Department = "開発部",
            .Salary = 5000000,
            .HireDate = New DateTime(2020, 4, 1)
        }
    End Sub
    
    Public Function WithFirstName(firstName As String) As TestDataBuilder
        _employee.FirstName = firstName
        Return Me
    End Function
    
    Public Function WithLastName(lastName As String) As TestDataBuilder
        _employee.LastName = lastName
        Return Me
    End Function
    
    Public Function WithEmail(email As String) As TestDataBuilder
        _employee.Email = email
        Return Me
    End Function
    
    Public Function WithDepartment(department As String) As TestDataBuilder
        _employee.Department = department
        Return Me
    End Function
    
    Public Function WithSalary(salary As Decimal) As TestDataBuilder
        _employee.Salary = salary
        Return Me
    End Function
    
    Public Function WithHireDate(hireDate As DateTime) As TestDataBuilder
        _employee.HireDate = hireDate
        Return Me
    End Function
    
    Public Function Build() As EmployeeDto
        Return _employee
    End Function
    
    ''' <summary>
    ''' 複数のテストデータを作成
    ''' </summary>
    Public Shared Function CreateMultipleEmployees(count As Integer) As List(Of EmployeeDto)
        Dim employees As New List(Of EmployeeDto)
        Dim departments() As String = {"営業部", "開発部", "総務部", "人事部"}
        
        For i As Integer = 1 To count
            employees.Add(New EmployeeDto With {
                .FirstName = $"太郎{i}",
                .LastName = $"山田{i}",
                .Email = $"employee{i}@example.com",
                .Department = departments((i - 1) Mod departments.Length),
                .Salary = 3000000 + (i * 100000),
                .HireDate = New DateTime(2020, 1, 1).AddMonths(i)
            })
        Next
        
        Return employees
    End Function
End Class
```

## 2. 統合テスト（DAO層）- データベース実アクセス

```vb
' EmployeeDaoIntegrationTests.vb
Imports Microsoft.VisualStudio.TestTools.UnitTesting

<TestClass>
Public Class EmployeeDaoIntegrationTests
    Private _dao As EmployeeDao
    
    ''' <summary>
    ''' テストクラス全体の初期化（最初に1回だけ実行）
    ''' </summary>
    <ClassInitialize>
    Public Shared Sub ClassInitialize(context As TestContext)
        TestDatabase.Initialize()
    End Sub
    
    ''' <summary>
    ''' 各テストメソッドの前に実行
    ''' </summary>
    <TestInitialize>
    Public Sub TestInitialize()
        ' テスト用接続文字列を使用するDAOを作成
        _dao = New EmployeeDao(TestDatabase.ConnectionString)
        
        ' データベースをクリーンアップ
        TestDatabase.Cleanup()
    End Sub
    
    <TestMethod>
    <TestCategory("Integration")>
    <TestCategory("Fast")>
    Public Sub InsertEmployee_正常なデータ_従業員が追加される()
        ' Arrange
        Dim employee = New TestDataBuilder() _
            .WithFirstName("太郎") _
            .WithLastName("山田") _
            .WithEmail("taro.yamada@example.com") _
            .Build()
        
        ' Act
        Dim employeeId = _dao.InsertEmployee(employee)
        
        ' Assert
        Assert.IsTrue(employeeId > 0, "従業員IDが取得できること")
        Assert.AreEqual(1, TestDatabase.GetEmployeeCount(), "レコードが1件追加されること")
    End Sub
    
    <TestMethod>
    <TestCategory("Integration")>
    <TestCategory("Fast")>
    Public Sub GetAllEmployees_複数のデータが存在する_全件取得できる()
        ' Arrange
        Dim testEmployees = TestDataBuilder.CreateMultipleEmployees(5)
        For Each emp In testEmployees
            TestDatabase.InsertTestEmployee(emp)
        Next
        
        ' Act
        Dim result = _dao.GetAllEmployees()
        
        ' Assert
        Assert.AreEqual(5, result.Count, "5件取得できること")
        Assert.AreEqual("太郎1", result(0).FirstName, "データが正しく取得できること")
    End Sub
    
    <TestMethod>
    <TestCategory("Integration")>
    <TestCategory("Fast")>
    Public Sub GetEmployeeById_存在するID_従業員が取得できる()
        ' Arrange
        Dim employee = New TestDataBuilder().Build()
        Dim employeeId = TestDatabase.InsertTestEmployee(employee)
        
        ' Act
        Dim result = _dao.GetEmployeeById(employeeId)
        
        ' Assert
        Assert.IsNotNull(result, "従業員が取得できること")
        Assert.AreEqual("太郎", result.FirstName)
        Assert.AreEqual("山田", result.LastName)
        Assert.AreEqual("taro.yamada@example.com", result.Email)
    End Sub
    
    <TestMethod>
    <TestCategory("Integration")>
    <TestCategory("Fast")>
    Public Sub GetEmployeeById_存在しないID_Nothingが返される()
        ' Arrange
        Dim nonExistentId = 9999
        
        ' Act
        Dim result = _dao.GetEmployeeById(nonExistentId)
        
        ' Assert
        Assert.IsNull(result, "存在しないIDの場合はNothingが返されること")
    End Sub
    
    <TestMethod>
    <TestCategory("Integration")>
    <TestCategory("Fast")>
    Public Sub UpdateEmployee_存在するデータ_更新される()
        ' Arrange
        Dim employee = New TestDataBuilder().Build()
        Dim employeeId = TestDatabase.InsertTestEmployee(employee)
        
        employee.EmployeeId = employeeId
        employee.FirstName = "次郎"
        employee.Salary = 6000000
        
        ' Act
        Dim result = _dao.UpdateEmployee(employee)
        
        ' Assert
        Assert.IsTrue(result, "更新が成功すること")
        
        Dim updated = _dao.GetEmployeeById(employeeId)
        Assert.AreEqual("次郎", updated.FirstName, "名前が更新されていること")
        Assert.AreEqual(6000000D, updated.Salary, "給与が更新されていること")
    End Sub
    
    <TestMethod>
    <TestCategory("Integration")>
    <TestCategory("Fast")>
    Public Sub DeleteEmployee_存在するデータ_削除される()
        ' Arrange
        Dim employee = New TestDataBuilder().Build()
        Dim employeeId = TestDatabase.InsertTestEmployee(employee)
        
        ' Act
        Dim result = _dao.DeleteEmployee(employeeId)
        
        ' Assert
        Assert.IsTrue(result, "削除が成功すること")
        Assert.AreEqual(0, TestDatabase.GetEmployeeCount(), "レコードが削除されること")
    End Sub
    
    <TestMethod>
    <TestCategory("Integration")>
    <TestCategory("Fast")>
    Public Sub DeleteEmployee_存在しないID_Falseが返される()
        ' Arrange
        Dim nonExistentId = 9999
        
        ' Act
        Dim result = _dao.DeleteEmployee(nonExistentId)
        
        ' Assert
        Assert.IsFalse(result, "存在しないIDの削除はFalseが返されること")
    End Sub
    
    ''' <summary>
    ''' パフォーマンステスト：大量データの挿入
    ''' </summary>
    <TestMethod>
    <TestCategory("Integration")>
    <TestCategory("Performance")>
    <Timeout(5000)> ' 5秒以内に完了すること
    Public Sub InsertEmployee_大量データ挿入_5秒以内に完了()
        ' Arrange & Act
        Dim stopwatch = Diagnostics.Stopwatch.StartNew()
        
        For i As Integer = 1 To 100
            Dim employee = New TestDataBuilder() _
                .WithEmail($"employee{i}@example.com") _
                .Build()
            _dao.InsertEmployee(employee)
        Next
        
        stopwatch.Stop()
        
        ' Assert
        Assert.AreEqual(100, TestDatabase.GetEmployeeCount(), "100件挿入されること")
        Console.WriteLine($"実行時間: {stopwatch.ElapsedMilliseconds}ms")
        Assert.IsTrue(stopwatch.ElapsedMilliseconds < 5000, "5秒以内に完了すること")
    End Sub
End Class
```

## 3. 単体テスト（ビジネスロジック層）

```vb
' EmployeeServiceUnitTests.vb
Imports Microsoft.VisualStudio.TestTools.UnitTesting

<TestClass>
Public Class EmployeeServiceUnitTests
    Private _service As EmployeeService
    
    <TestInitialize>
    Public Sub TestInitialize()
        ' テスト用接続文字列を使用
        _service = New EmployeeService(TestDatabase.ConnectionString)
        TestDatabase.Cleanup()
    End Sub
    
    <TestMethod>
    <TestCategory("Unit")>
    <TestCategory("Fast")>
    Public Sub AddEmployee_正常なデータ_追加成功()
        ' Arrange
        Dim employee = New TestDataBuilder() _
            .WithFirstName("花子") _
            .WithLastName("佐藤") _
            .WithEmail("hanako.sato@example.com") _
            .Build()
        
        ' Act
        Dim employeeId = _service.AddEmployee(employee)
        
        ' Assert
        Assert.IsTrue(employeeId > 0, "従業員IDが返されること")
    End Sub
    
    <TestMethod>
    <TestCategory("Unit")>
    <TestCategory("Fast")>
    <ExpectedException(GetType(ValidationException))>
    Public Sub AddEmployee_名前が空_ValidationExceptionが発生()
        ' Arrange
        Dim employee = New TestDataBuilder() _
            .WithFirstName("") _
            .Build()
        
        ' Act
        _service.AddEmployee(employee)
        
        ' Assert - ExpectedExceptionで検証
    End Sub
    
    <TestMethod>
    <TestCategory("Unit")>
    <TestCategory("Fast")>
    <ExpectedException(GetType(ValidationException))>
    Public Sub AddEmployee_苗字が空_ValidationExceptionが発生()
        ' Arrange
        Dim employee = New TestDataBuilder() _
            .WithLastName("") _
            .Build()
        
        ' Act
        _service.AddEmployee(employee)
        
        ' Assert - ExpectedExceptionで検証
    End Sub
    
    <TestMethod>
    <TestCategory("Unit")>
    <TestCategory("Fast")>
    Public Sub AddEmployee_無効なメールアドレス_ValidationExceptionが発生()
        ' Arrange
        Dim employee = New TestDataBuilder() _
            .WithEmail("invalid-email") _
            .Build()
        
        ' Act & Assert
        Try
            _service.AddEmployee(employee)
            Assert.Fail("ValidationExceptionが発生すべき")
        Catch ex As ValidationException
            StringAssert.Contains(ex.Message, "有効なメールアドレス", "エラーメッセージが正しいこと")
        End Try
    End Sub
    
    <TestMethod>
    <TestCategory("Unit")>
    <TestCategory("Fast")>
    Public Sub AddEmployee_給与が0以下_ValidationExceptionが発生()
        ' Arrange
        Dim employee = New TestDataBuilder() _
            .WithSalary(0) _
            .Build()
        
        ' Act & Assert
        Try
            _service.AddEmployee(employee)
            Assert.Fail("ValidationExceptionが発生すべき")
        Catch ex As ValidationException
            StringAssert.Contains(ex.Message, "給与は0より大きい", "エラーメッセージが正しいこと")
        End Try
    End Sub
    
    <TestMethod>
    <TestCategory("Unit")>
    <TestCategory("Fast")>
    Public Sub AddEmployee_未来の入社日_ValidationExceptionが発生()
        ' Arrange
        Dim futureDate = DateTime.Now.AddDays(1)
        Dim employee = New TestDataBuilder() _
            .WithHireDate(futureDate) _
            .Build()
        
        ' Act & Assert
        Try
            _service.AddEmployee(employee)
            Assert.Fail("ValidationExceptionが発生すべき")
        Catch ex As ValidationException
            StringAssert.Contains(ex.Message, "入社日は現在より前", "エラーメッセージが正しいこと")
        End Try
    End Sub
    
    <TestMethod>
    <TestCategory("Unit")>
    <TestCategory("Fast")>
    Public Sub GetEmployeesByDepartment_開発部でフィルタ_開発部のみ取得()
        ' Arrange
        TestDatabase.InsertTestEmployee(New TestDataBuilder().WithDepartment("開発部").Build())
        TestDatabase.InsertTestEmployee(New TestDataBuilder().WithDepartment("営業部").Build())
        TestDatabase.InsertTestEmployee(New TestDataBuilder().WithDepartment("開発部").Build())
        
        ' Act
        Dim result = _service.GetEmployeesByDepartment("開発部")
        
        ' Assert
        Assert.AreEqual(2, result.Count, "開発部の従業員が2件取得されること")
        Assert.IsTrue(result.All(Function(e) e.Department = "開発部"), "全て開発部であること")
    End Sub
    
    <TestMethod>
    <TestCategory("Unit")>
    <TestCategory("Fast")>
    Public Sub CalculateAverageSalary_複数の従業員_正しい平均値()
        ' Arrange
        TestDatabase.InsertTestEmployee(New TestDataBuilder().WithSalary(3000000).Build())
        TestDatabase.InsertTestEmployee(New TestDataBuilder().WithSalary(4000000).Build())
        TestDatabase.InsertTestEmployee(New TestDataBuilder().WithSalary(5000000).Build())
        
        ' Act
        Dim average = _service.CalculateAverageSalary()
        
        ' Assert
        Assert.AreEqual(4000000D, average, "平均給与が正しく計算されること")
    End Sub
    
    <TestMethod>
    <TestCategory("Unit")>
    <TestCategory("Fast")>
    Public Sub CalculateAverageSalary_従業員が0件_0が返される()
        ' Arrange - データなし
        
        ' Act
        Dim average = _service.CalculateAverageSalary()
        
        ' Assert
        Assert.AreEqual(0D, average, "従業員が0件の場合は0が返されること")
    End Sub
    
    <TestMethod>
    <TestCategory("Unit")>
    <TestCategory("Fast")>
    Public Sub UpdateEmployee_正常なデータ_更新成功()
        ' Arrange
        Dim employee = New TestDataBuilder().Build()
        Dim employeeId = TestDatabase.InsertTestEmployee(employee)
        
        employee.EmployeeId = employeeId
        employee.FirstName = "三郎"
        employee.Salary = 5500000
        
        ' Act
        Dim result = _service.UpdateEmployee(employee)
        
        ' Assert
        Assert.IsTrue(result, "更新が成功すること")
    End Sub
    
    ''' <summary>
    ''' 複数のバリデーションエラーが同時に発生する場合
    ''' </summary>
    <TestMethod>
    <TestCategory("Unit")>
    <TestCategory("Fast")>
    Public Sub AddEmployee_複数のバリデーションエラー_全てのエラーが含まれる()
        ' Arrange
        Dim employee = New TestDataBuilder() _
            .WithFirstName("") _
            .WithLastName("") _
            .WithEmail("invalid") _
            .WithSalary(-1000) _
            .Build()
        
        ' Act & Assert
        Try
            _service.AddEmployee(employee)
            Assert.Fail("ValidationExceptionが発生すべき")
        Catch ex As ValidationException
            ' 複数のエラーメッセージが含まれることを確認
            StringAssert.Contains(ex.Message, "名前を入力", "名前のエラーが含まれること")
            StringAssert.Contains(ex.Message, "苗字を入力", "苗字のエラーが含まれること")
            StringAssert.Contains(ex.Message, "有効なメールアドレス", "メールのエラーが含まれること")
            StringAssert.Contains(ex.Message, "給与は0より大きい", "給与のエラーが含まれること")
        End Try
    End Sub
End Class
```

## 4. DTO検証テスト

```vb
' EmployeeDtoTests.vb
Imports Microsoft.VisualStudio.TestTools.UnitTesting

<TestClass>
Public Class EmployeeDtoTests
    
    <TestMethod>
    <TestCategory("Unit")>
    <TestCategory("Fast")>
    Public Sub FullName_名前と苗字が設定されている_フルネームが返される()
        ' Arrange
        Dim employee As New EmployeeDto With {
            .FirstName = "太郎",
            .LastName = "山田"
        }
        
        ' Act
        Dim fullName = employee.FullName
        
        ' Assert
        Assert.AreEqual("太郎 山田", fullName, "フルネームが正しく構築されること")
    End Sub
    
    <TestMethod>
    <TestCategory("Unit")>
    <TestCategory("Fast")>
    Public Sub EmployeeDto_全プロパティ設定_正しく取得できる()
        ' Arrange
        Dim hireDate = New DateTime(2020, 4, 1)
        Dim employee As New EmployeeDto With {
            .EmployeeId = 1,
            .FirstName = "花子",
            .LastName = "佐藤",
            .Email = "hanako@example.com",
            .Department = "営業部",
            .Salary = 4500000,
            .HireDate = hireDate
        }
        
        ' Assert
        Assert.AreEqual(1, employee.EmployeeId)
        Assert.AreEqual("花子", employee.FirstName)
        Assert.AreEqual("佐藤", employee.LastName)
        Assert.AreEqual("hanako@example.com", employee.Email)
        Assert.AreEqual("営業部", employee.Department)
        Assert.AreEqual(4500000D, employee.Salary)
        Assert.AreEqual(hireDate, employee.HireDate)
    End Sub
End Class
```

## 5. テスト実行設定ファイル

### .runsettings

```xml
<?xml version="1.0" encoding="utf-8"?>
<RunSettings>
  <RunConfiguration>
    <!-- テストのタイムアウト（ミリ秒） -->
    <TestSessionTimeout>300000</TestSessionTimeout>
    <!-- 並列実行の設定 -->
    <MaxCpuCount>0</MaxCpuCount>
  </RunConfiguration>
  
  <MSTest>
    <!-- テストメソッドのタイムアウト（ミリ秒） -->
    <Timeout>60000</Timeout>
    <!-- 並列実行を有効化 -->
    <Parallelize>
      <Workers>4</Workers>
      <Scope>MethodLevel</Scope>
    </Parallelize>
  </MSTest>
  
  <!-- コードカバレッジ設定 -->
  <DataCollectionRunSettings>
    <DataCollectors>
      <DataCollector friendlyName="Code Coverage" />
    </DataCollectors>
  </DataCollectionRunSettings>
</RunSettings>
```

## 6. テストカテゴリ別実行用バッチファイル

### run-fast-tests.bat

```batch
@echo off
echo 高速テストのみ実行...
dotnet test --filter "TestCategory=Fast" --logger "console;verbosity=normal"
pause
```

### run-all-tests.bat

```batch
@echo off
echo 全てのテストを実行...
dotnet test --logger "console;verbosity=normal"
pause
```

### run-integration-tests.bat

```batch
@echo off
echo 統合テストを実行...
dotnet test --filter "TestCategory=Integration" --logger "console;verbosity=normal"
pause
```

## 7. CI/CD用のテスト実行スクリプト

### azure-pipelines.yml (Azure DevOps用)

```yaml
trigger:
- main
- develop

pool:
  vmImage: 'windows-latest'

variables:
  solution: '**/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'

steps:
- task: NuGetToolInstaller@1

- task: NuGetCommand@2
  inputs:
    restoreSolution: '$(solution)'

- task: VSBuild@1
  inputs:
    solution: '$(solution)'
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'

# 高速テスト（必須）
- task: VSTest@2
  displayName: '高速テスト実行'
  inputs:
    testSelector: 'testAssemblies'
    testAssemblyVer2: |
      **\*Tests.dll
      !**\*TestAdapter.dll
      !**\obj\**
    testFiltercriteria: 'TestCategory=Fast'
    runInParallel: true
    codeCoverageEnabled: true

# 統合テスト（オプショナル、夜間実行など）
- task: VSTest@2
  displayName: '統合テスト実行'
  condition: and(succeeded(), eq(variables['Build.Reason'], 'Schedule'))
  inputs:
    testSelector: 'testAssemblies'
    testAssemblyVer2: |
      **\*Tests.dll
      !**\*TestAdapter.dll
      !**\obj\**
    testFiltercriteria: 'TestCategory=Integration'
    runInParallel: false
    codeCoverageEnabled: true
```

## 8. AssertHelperクラス（カスタムアサーション）

```vb
' AssertHelper.vb
Imports Microsoft.VisualStudio.TestTools.UnitTesting

Public Class AssertHelper
    ''' <summary>
    ''' 2つのEmployeeDtoが等しいか検証
    ''' </summary>
    Public Shared Sub AreEmployeesEqual(expected As EmployeeDto, actual As EmployeeDto, message As String)
        Assert.AreEqual(expected.FirstName, actual.FirstName, $"{message}: FirstName")
        Assert.AreEqual(expected.LastName, actual.LastName, $"{message}: LastName")
        Assert.AreEqual(expected.Email, actual.Email, $"{message}: Email")
        Assert.AreEqual(expected.Department, actual.Department, $"{message}: Department")
        Assert.AreEqual(expected.Salary, actual.Salary, $"{message}: Salary")
        Assert.AreEqual(expected.HireDate.Date, actual.HireDate.Date, $"{message}: HireDate")
    End Sub
    
    ''' <summary>
    ''' コレクションの要素数と内容を検証
    ''' </summary>
    Public Shared Sub AssertCollection(Of T)(expected As List(Of T), actual As List(Of T), 
                                             comparer As Func(Of T, T, Boolean))
        Assert.AreEqual(expected.Count, actual.Count, "要素数が一致すること")
        
        For i As Integer = 0 To expected.Count - 1
            Assert.IsTrue(comparer(expected(i), actual(i)), $"インデックス{i}の要素が一致すること")
        Next
    End Sub
End Class
```

## 9. パフォーマンステストクラス

```vb
' PerformanceTests.vb
Imports Microsoft.VisualStudio.TestTools.UnitTesting

<TestClass>
Public Class PerformanceTests
    
    <ClassInitialize>
    Public Shared Sub ClassInitialize(context As TestContext)
        TestDatabase.Initialize()
    End Sub
    
    <TestInitialize>
    Public Sub TestInitialize()
        TestDatabase.Cleanup()
        
        ' 大量のテストデータを準備
        Dim employees = TestDataBuilder.CreateMultipleEmployees(1000)
        For Each emp In employees
            TestDatabase.InsertTestEmployee(emp)
        Next
    End Sub
    
    <TestMethod>
    <TestCategory("Performance")>
    <TestCategory("Slow")>
    <Timeout(3000)> ' 3秒以内
    Public Sub GetAllEmployees_1000件のデータ_3秒以内に取得()
        ' Arrange
        Dim dao As New EmployeeDao(TestDatabase.ConnectionString)
        Dim stopwatch = Diagnostics.Stopwatch.StartNew()
        
        ' Act
        Dim result = dao.GetAllEmployees()
        stopwatch.Stop()
        
        ' Assert
        Assert.AreEqual(1000, result.Count, "1000件取得できること")
        Console.WriteLine($"実行時間: {stopwatch.ElapsedMilliseconds}ms")
        Assert.IsTrue(stopwatch.ElapsedMilliseconds < 3000, "3秒以内に完了すること")
    End Sub
    
    <TestMethod>
    <TestCategory("Performance")>
    <TestCategory("Slow")>
    Public Sub CalculateAverageSalary_1000件のデータ_パフォーマンス計測()
        ' Arrange
        Dim service As New EmployeeService(TestDatabase.ConnectionString)
        Dim stopwatch = Diagnostics.Stopwatch.StartNew()
        
        ' Act
        Dim average = service.CalculateAverageSalary()
        stopwatch.Stop()
        
        ' Assert
        Assert.IsTrue(average > 0, "平均給与が計算されること")
        Console.WriteLine($"実行時間: {stopwatch.ElapsedMilliseconds}ms")
        Console.WriteLine($"平均給与: {average:C0}")
        
        ' パフォーマンスログをテストコンテキストに出力
    End Sub
End Class
```

## テスト実行のベストプラクティス

### 1. テストカテゴリの使い分け

- **Fast**: 1秒以内、依存関係なし、CI/CDで毎回実行
- **Integration**: データベースアクセスあり、数秒程度、コミット前に実行
- **Slow**: 時間がかかるテスト、夜間バッチで実行
- **Performance**: パフォーマンス計測、定期的に実行

### 2. テスト実行順序

```
1. Fast単体テスト（開発中、常時）
2. Integration統合テスト（コミット前）
3. Performance性能テスト（週次）
```

### 3. Visual Studioでのフィルタ実行

Test Explorerで以下のフィルタを使用:
```
TestCategory=Fast
TestCategory=Integration
TestCategory!=Slow
```

このテスト構成により、開発速度を維持しながら品質を確保できます。
