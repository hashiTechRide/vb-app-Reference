# はじめに
## 開発環境
- 開発対象: `.NET Framework4.8`
- 開発言語: `VB.NET`

# 単純なデザイントークン管理用コントロール
`IExtenderProvider`を使用して、既存のコントロールにプロパティを動的に追加します。

## 1. デザイントークン管理クラス

```vb
Imports System.ComponentModel
Imports System.Drawing

Public Class DesignTokens
    Public Property PrimaryColor As Color = Color.FromArgb(0, 120, 215)
    Public Property SecondaryColor As Color = Color.FromArgb(100, 100, 100)
    Public Property BackgroundColor As Color = Color.White
    Public Property TextColor As Color = Color.Black
    Public Property BorderColor As Color = Color.Gray
    
    ' トークン名の列挙
    Public Enum TokenType
        None
        PrimaryColor
        SecondaryColor
        BackgroundColor
        TextColor
        BorderColor
    End Enum
End Class
```

## 2. デザイントークンマネージャーコンポーネント

```vb
Imports System.ComponentModel
Imports System.ComponentModel.Design
Imports System.Drawing
Imports System.Windows.Forms

<ProvideProperty("BackColorToken", GetType(Control))>
<ProvideProperty("ForeColorToken", GetType(Control))>
<Designer(GetType(DesignTokenManagerDesigner))>
Public Class DesignTokenManager
    Inherits Component
    Implements IExtenderProvider
    
    Private _tokens As New DesignTokens()
    Private _tokenMappings As New Dictionary(Of Control, ControlTokenMapping)
    
    <Category("デザイントークン")>
    <Description("デザイントークンの設定")>
    <DesignerSerializationVisibility(DesignerSerializationVisibility.Content)>
    Public Property Tokens As DesignTokens
        Get
            Return _tokens
        End Get
        Set(value As DesignTokens)
            _tokens = value
            ApplyTokensToAllControls()
        End Set
    End Property
    
    ' IExtenderProvider の実装
    Public Function CanExtend(extendee As Object) As Boolean Implements IExtenderProvider.CanExtend
        ' Form以外のControlにプロパティを追加
        Return TypeOf extendee Is Control AndAlso Not TypeOf extendee Is Form
    End Function
    
    ' BackColorToken プロパティの取得
    <Category("デザイントークン")>
    <Description("背景色に適用するトークン")>
    <DefaultValue(GetType(DesignTokens.TokenType), "None")>
    Public Function GetBackColorToken(control As Control) As DesignTokens.TokenType
        If _tokenMappings.ContainsKey(control) Then
            Return _tokenMappings(control).BackColorToken
        End If
        Return DesignTokens.TokenType.None
    End Function
    
    Public Sub SetBackColorToken(control As Control, value As DesignTokens.TokenType)
        Dim mapping As ControlTokenMapping = GetOrCreateMapping(control)
        mapping.BackColorToken = value
        ApplyToken(control, value, True)
    End Sub
    
    ' ForeColorToken プロパティの取得
    <Category("デザイントークン")>
    <Description("前景色に適用するトークン")>
    <DefaultValue(GetType(DesignTokens.TokenType), "None")>
    Public Function GetForeColorToken(control As Control) As DesignTokens.TokenType
        If _tokenMappings.ContainsKey(control) Then
            Return _tokenMappings(control).ForeColorToken
        End If
        Return DesignTokens.TokenType.None
    End Function
    
    Public Sub SetForeColorToken(control As Control, value As DesignTokens.TokenType)
        Dim mapping As ControlTokenMapping = GetOrCreateMapping(control)
        mapping.ForeColorToken = value
        ApplyToken(control, value, False)
    End Sub
    
    ' マッピングの取得または作成
    Private Function GetOrCreateMapping(control As Control) As ControlTokenMapping
        If Not _tokenMappings.ContainsKey(control) Then
            Dim mapping As New ControlTokenMapping()
            _tokenMappings.Add(control, mapping)
            AddHandler control.Disposed, AddressOf Control_Disposed
        End If
        Return _tokenMappings(control)
    End Function
    
    ' コントロールが破棄されたときのクリーンアップ
    Private Sub Control_Disposed(sender As Object, e As EventArgs)
        Dim control As Control = CType(sender, Control)
        If _tokenMappings.ContainsKey(control) Then
            _tokenMappings.Remove(control)
        End If
    End Sub
    
    ' トークンを適用
    Private Sub ApplyToken(control As Control, tokenType As DesignTokens.TokenType, isBackColor As Boolean)
        Dim color As Color = GetColorFromToken(tokenType)
        
        If color <> Color.Empty Then
            If isBackColor Then
                control.BackColor = color
            Else
                control.ForeColor = color
            End If
        End If
    End Sub
    
    ' トークンから色を取得
    Private Function GetColorFromToken(tokenType As DesignTokens.TokenType) As Color
        Select Case tokenType
            Case DesignTokens.TokenType.PrimaryColor
                Return _tokens.PrimaryColor
            Case DesignTokens.TokenType.SecondaryColor
                Return _tokens.SecondaryColor
            Case DesignTokens.TokenType.BackgroundColor
                Return _tokens.BackgroundColor
            Case DesignTokens.TokenType.TextColor
                Return _tokens.TextColor
            Case DesignTokens.TokenType.BorderColor
                Return _tokens.BorderColor
            Case Else
                Return Color.Empty
        End Select
    End Function
    
    ' すべてのコントロールにトークンを適用
    Public Sub ApplyTokensToAllControls()
        For Each kvp In _tokenMappings
            Dim control As Control = kvp.Key
            Dim mapping As ControlTokenMapping = kvp.Value
            
            If mapping.BackColorToken <> DesignTokens.TokenType.None Then
                ApplyToken(control, mapping.BackColorToken, True)
            End If
            
            If mapping.ForeColorToken <> DesignTokens.TokenType.None Then
                ApplyToken(control, mapping.ForeColorToken, False)
            End If
        Next
    End Sub
    
    ' マッピング情報を保持するクラス
    Private Class ControlTokenMapping
        Public Property BackColorToken As DesignTokens.TokenType = DesignTokens.TokenType.None
        Public Property ForeColorToken As DesignTokens.TokenType = DesignTokens.TokenType.None
    End Class
End Class
```

## 3. カスタムデザイナー

```vb
Imports System.ComponentModel
Imports System.ComponentModel.Design
Imports System.Windows.Forms.Design

Public Class DesignTokenManagerDesigner
    Inherits ComponentDesigner
    
    Public Overrides Sub Initialize(component As IComponent)
        MyBase.Initialize(component)
    End Sub
    
    Public Overrides ReadOnly Property ActionLists As DesignerActionListCollection
        Get
            Dim actionLists As New DesignerActionListCollection()
            actionLists.Add(New DesignTokenManagerActionList(Me.Component))
            Return actionLists
        End Get
    End Property
    
    ' プロパティの変更を監視
    Protected Overrides Sub PreFilterProperties(properties As IDictionary)
        MyBase.PreFilterProperties(properties)
    End Sub
End Class
```

## 4. スマートタグアクションリスト

```vb
Imports System.ComponentModel
Imports System.ComponentModel.Design
Imports System.Drawing

Public Class DesignTokenManagerActionList
    Inherits DesignerActionList
    
    Private _manager As DesignTokenManager
    
    Public Sub New(component As IComponent)
        MyBase.New(component)
        _manager = CType(component, DesignTokenManager)
    End Sub
    
    Public Overrides Function GetSortedActionItems() As DesignerActionItemCollection
        Dim items As New DesignerActionItemCollection()
        
        items.Add(New DesignerActionHeaderItem("デザイントークン設定"))
        
        items.Add(New DesignerActionPropertyItem("PrimaryColor",
                  "プライマリカラー", "デザイントークン",
                  "プライマリカラーを設定します"))
        
        items.Add(New DesignerActionPropertyItem("SecondaryColor",
                  "セカンダリカラー", "デザイントークン",
                  "セカンダリカラーを設定します"))
        
        items.Add(New DesignerActionPropertyItem("BackgroundColor",
                  "背景色", "デザイントークン",
                  "背景色を設定します"))
        
        items.Add(New DesignerActionPropertyItem("TextColor",
                  "テキスト色", "デザイントークン",
                  "テキスト色を設定します"))
        
        items.Add(New DesignerActionMethodItem(Me, "ApplyToAll",
                  "すべてに適用", "アクション",
                  "トークンをすべてのコントロールに適用します"))
        
        Return items
    End Function
    
    Public Property PrimaryColor As Color
        Get
            Return _manager.Tokens.PrimaryColor
        End Get
        Set(value As Color)
            GetPropertyByName("Tokens").GetChildProperties()("PrimaryColor").SetValue(_manager.Tokens, value)
            _manager.ApplyTokensToAllControls()
        End Set
    End Property
    
    Public Property SecondaryColor As Color
        Get
            Return _manager.Tokens.SecondaryColor
        End Get
        Set(value As Color)
            GetPropertyByName("Tokens").GetChildProperties()("SecondaryColor").SetValue(_manager.Tokens, value)
            _manager.ApplyTokensToAllControls()
        End Set
    End Property
    
    Public Property BackgroundColor As Color
        Get
            Return _manager.Tokens.BackgroundColor
        End Get
        Set(value As Color)
            GetPropertyByName("Tokens").GetChildProperties()("BackgroundColor").SetValue(_manager.Tokens, value)
            _manager.ApplyTokensToAllControls()
        End Set
    End Property
    
    Public Property TextColor As Color
        Get
            Return _manager.Tokens.TextColor
        End Get
        Set(value As Color)
            GetPropertyByName("Tokens").GetChildProperties()("TextColor").SetValue(_manager.Tokens, value)
            _manager.ApplyTokensToAllControls()
        End Set
    End Property
    
    Public Sub ApplyToAll()
        _manager.ApplyTokensToAllControls()
    End Sub
    
    Private Function GetPropertyByName(propName As String) As PropertyDescriptor
        Return TypeDescriptor.GetProperties(_manager)(propName)
    End Function
End Class
```

## 5. 使い方

1. **プロジェクトをビルド**してコンポーネントを登録
2. **ツールボックスから`DesignTokenManager`をフォームにドラッグ**
3. **各コントロールを選択**すると、プロパティウィンドウに以下が表示されます：
   - `BackColorToken` (デザイントークン)
   - `ForeColorToken` (デザイントークン)
4. **ドロップダウンからトークンを選択**（PrimaryColor、SecondaryColorなど）
5. **`DesignTokenManager`のプロパティ**で色を変更すると、関連するすべてのコントロールが更新されます

この実装により、デザイントークンによる一元管理が可能になり、デザイナー上でも直感的に設定できます。

# もう少し改良したバージョン
デザイントークンを複数のフォーム・ユーザーコントロール間で共有できるようにしていきます。
方法としては、シングルトンパターンと設定ファイルを使用します。

## 1. グローバルデザイントークンマネージャー（シングルトン）

```vb
Imports System.Drawing
Imports System.IO
Imports System.Xml.Serialization

Public Class GlobalDesignTokens
    Private Shared _instance As GlobalDesignTokens
    Private Shared ReadOnly _lock As New Object()
    
    ' トークンが変更されたときのイベント
    Public Event TokensChanged As EventHandler
    
    Private _tokens As New DesignTokens()
    
    ' シングルトンインスタンスの取得
    Public Shared ReadOnly Property Instance As GlobalDesignTokens
        Get
            If _instance Is Nothing Then
                SyncLock _lock
                    If _instance Is Nothing Then
                        _instance = New GlobalDesignTokens()
                        _instance.LoadFromFile()
                    End If
                End SyncLock
            End If
            Return _instance
        End Get
    End Property
    
    Private Sub New()
        ' プライベートコンストラクタ
    End Sub
    
    Public Property Tokens As DesignTokens
        Get
            Return _tokens
        End Get
        Set(value As DesignTokens)
            _tokens = value
            RaiseEvent TokensChanged(Me, EventArgs.Empty)
        End Set
    End Property
    
    ' トークンの色を更新
    Public Sub UpdateToken(tokenType As DesignTokens.TokenType, color As Color)
        Select Case tokenType
            Case DesignTokens.TokenType.PrimaryColor
                _tokens.PrimaryColor = color
            Case DesignTokens.TokenType.SecondaryColor
                _tokens.SecondaryColor = color
            Case DesignTokens.TokenType.BackgroundColor
                _tokens.BackgroundColor = color
            Case DesignTokens.TokenType.TextColor
                _tokens.TextColor = color
            Case DesignTokens.TokenType.BorderColor
                _tokens.BorderColor = color
        End Select
        
        RaiseEvent TokensChanged(Me, EventArgs.Empty)
    End Sub
    
    ' ファイルから読み込み
    Public Sub LoadFromFile(Optional filePath As String = "DesignTokens.xml")
        Try
            If File.Exists(filePath) Then
                Dim serializer As New XmlSerializer(GetType(DesignTokens))
                Using stream As New FileStream(filePath, FileMode.Open)
                    _tokens = CType(serializer.Deserialize(stream), DesignTokens)
                End Using
                RaiseEvent TokensChanged(Me, EventArgs.Empty)
            End If
        Catch ex As Exception
            ' エラー時はデフォルト値を使用
            _tokens = New DesignTokens()
        End Try
    End Sub
    
    ' ファイルに保存
    Public Sub SaveToFile(Optional filePath As String = "DesignTokens.xml")
        Try
            Dim serializer As New XmlSerializer(GetType(DesignTokens))
            Using stream As New FileStream(filePath, FileMode.Create)
                serializer.Serialize(stream, _tokens)
            End Using
        Catch ex As Exception
            ' エラーハンドリング
        End Try
    End Sub
End Class
```

## 2. 改良版DesignTokens（シリアライズ対応）

```vb
Imports System.ComponentModel
Imports System.Drawing
Imports System.Xml.Serialization

<Serializable()>
Public Class DesignTokens
    Private _primaryColor As Color = Color.FromArgb(0, 120, 215)
    Private _secondaryColor As Color = Color.FromArgb(100, 100, 100)
    Private _backgroundColor As Color = Color.White
    Private _textColor As Color = Color.Black
    Private _borderColor As Color = Color.Gray
    
    ' XMLシリアライズ用のInt32プロパティ
    <XmlElement("PrimaryColor")>
    Public Property PrimaryColorArgb As Integer
        Get
            Return _primaryColor.ToArgb()
        End Get
        Set(value As Integer)
            _primaryColor = Color.FromArgb(value)
        End Set
    End Property
    
    <XmlElement("SecondaryColor")>
    Public Property SecondaryColorArgb As Integer
        Get
            Return _secondaryColor.ToArgb()
        End Get
        Set(value As Integer)
            _secondaryColor = Color.FromArgb(value)
        End Set
    End Property
    
    <XmlElement("BackgroundColor")>
    Public Property BackgroundColorArgb As Integer
        Get
            Return _backgroundColor.ToArgb()
        End Get
        Set(value As Integer)
            _backgroundColor = Color.FromArgb(value)
        End Set
    End Property
    
    <XmlElement("TextColor")>
    Public Property TextColorArgb As Integer
        Get
            Return _textColor.ToArgb()
        End Get
        Set(value As Integer)
            _textColor = Color.FromArgb(value)
        End Set
    End Property
    
    <XmlElement("BorderColor")>
    Public Property BorderColorArgb As Integer
        Get
            Return _borderColor.ToArgb()
        End Get
        Set(value As Integer)
            _borderColor = Color.FromArgb(value)
        End Set
    End Property
    
    ' 実際に使用するColorプロパティ
    <XmlIgnore()>
    Public Property PrimaryColor As Color
        Get
            Return _primaryColor
        End Get
        Set(value As Color)
            _primaryColor = value
        End Set
    End Property
    
    <XmlIgnore()>
    Public Property SecondaryColor As Color
        Get
            Return _secondaryColor
        End Get
        Set(value As Color)
            _secondaryColor = value
        End Set
    End Property
    
    <XmlIgnore()>
    Public Property BackgroundColor As Color
        Get
            Return _backgroundColor
        End Get
        Set(value As Color)
            _backgroundColor = value
        End Set
    End Property
    
    <XmlIgnore()>
    Public Property TextColor As Color
        Get
            Return _textColor
        End Get
        Set(value As Color)
            _textColor = value
        End Set
    End Property
    
    <XmlIgnore()>
    Public Property BorderColor As Color
        Get
            Return _borderColor
        End Get
        Set(value As Color)
            _borderColor = value
        End Set
    End Property
    
    Public Enum TokenType
        None
        PrimaryColor
        SecondaryColor
        BackgroundColor
        TextColor
        BorderColor
    End Enum
End Class
```

## 3. 改良版DesignTokenManager（グローバル対応）

```vb
Imports System.ComponentModel
Imports System.ComponentModel.Design
Imports System.Drawing
Imports System.Windows.Forms

<ProvideProperty("BackColorToken", GetType(Control))>
<ProvideProperty("ForeColorToken", GetType(Control))>
<Designer(GetType(DesignTokenManagerDesigner))>
Public Class DesignTokenManager
    Inherits Component
    Implements IExtenderProvider
    
    Private _tokenMappings As New Dictionary(Of Control, ControlTokenMapping)
    Private _useGlobalTokens As Boolean = True
    Private _localTokens As DesignTokens = Nothing
    
    Public Sub New()
        ' グローバルトークンの変更イベントを購読
        AddHandler GlobalDesignTokens.Instance.TokensChanged, AddressOf OnGlobalTokensChanged
    End Sub
    
    <Category("デザイントークン")>
    <Description("グローバルトークンを使用するか、ローカルトークンを使用するか")>
    <DefaultValue(True)>
    Public Property UseGlobalTokens As Boolean
        Get
            Return _useGlobalTokens
        End Get
        Set(value As Boolean)
            _useGlobalTokens = value
            ApplyTokensToAllControls()
        End Set
    End Property
    
    <Category("デザイントークン")>
    <Description("ローカルのデザイントークン設定（UseGlobalTokens=Falseの場合に使用）")>
    <DesignerSerializationVisibility(DesignerSerializationVisibility.Content)>
    Public Property LocalTokens As DesignTokens
        Get
            If _localTokens Is Nothing Then
                _localTokens = New DesignTokens()
            End If
            Return _localTokens
        End Get
        Set(value As DesignTokens)
            _localTokens = value
            If Not _useGlobalTokens Then
                ApplyTokensToAllControls()
            End If
        End Set
    End Property
    
    ' 現在のトークンを取得（グローバルまたはローカル）
    Private ReadOnly Property CurrentTokens As DesignTokens
        Get
            If _useGlobalTokens Then
                Return GlobalDesignTokens.Instance.Tokens
            Else
                Return LocalTokens
            End If
        End Get
    End Property
    
    ' グローバルトークンが変更されたときの処理
    Private Sub OnGlobalTokensChanged(sender As Object, e As EventArgs)
        If _useGlobalTokens Then
            ApplyTokensToAllControls()
        End If
    End Sub
    
    Public Function CanExtend(extendee As Object) As Boolean Implements IExtenderProvider.CanExtend
        Return TypeOf extendee Is Control AndAlso Not TypeOf extendee Is Form
    End Function
    
    <Category("デザイントークン")>
    <Description("背景色に適用するトークン")>
    <DefaultValue(GetType(DesignTokens.TokenType), "None")>
    Public Function GetBackColorToken(control As Control) As DesignTokens.TokenType
        If _tokenMappings.ContainsKey(control) Then
            Return _tokenMappings(control).BackColorToken
        End If
        Return DesignTokens.TokenType.None
    End Function
    
    Public Sub SetBackColorToken(control As Control, value As DesignTokens.TokenType)
        Dim mapping As ControlTokenMapping = GetOrCreateMapping(control)
        mapping.BackColorToken = value
        ApplyToken(control, value, True)
    End Sub
    
    <Category("デザイントークン")>
    <Description("前景色に適用するトークン")>
    <DefaultValue(GetType(DesignTokens.TokenType), "None")>
    Public Function GetForeColorToken(control As Control) As DesignTokens.TokenType
        If _tokenMappings.ContainsKey(control) Then
            Return _tokenMappings(control).ForeColorToken
        End If
        Return DesignTokens.TokenType.None
    End Function
    
    Public Sub SetForeColorToken(control As Control, value As DesignTokens.TokenType)
        Dim mapping As ControlTokenMapping = GetOrCreateMapping(control)
        mapping.ForeColorToken = value
        ApplyToken(control, value, False)
    End Sub
    
    Private Function GetOrCreateMapping(control As Control) As ControlTokenMapping
        If Not _tokenMappings.ContainsKey(control) Then
            Dim mapping As New ControlTokenMapping()
            _tokenMappings.Add(control, mapping)
            AddHandler control.Disposed, AddressOf Control_Disposed
        End If
        Return _tokenMappings(control)
    End Function
    
    Private Sub Control_Disposed(sender As Object, e As EventArgs)
        Dim control As Control = CType(sender, Control)
        If _tokenMappings.ContainsKey(control) Then
            _tokenMappings.Remove(control)
        End If
    End Sub
    
    Private Sub ApplyToken(control As Control, tokenType As DesignTokens.TokenType, isBackColor As Boolean)
        Dim color As Color = GetColorFromToken(tokenType)
        
        If color <> Color.Empty Then
            If isBackColor Then
                control.BackColor = color
            Else
                control.ForeColor = color
            End If
        End If
    End Sub
    
    Private Function GetColorFromToken(tokenType As DesignTokens.TokenType) As Color
        Dim tokens As DesignTokens = CurrentTokens
        
        Select Case tokenType
            Case DesignTokens.TokenType.PrimaryColor
                Return tokens.PrimaryColor
            Case DesignTokens.TokenType.SecondaryColor
                Return tokens.SecondaryColor
            Case DesignTokens.TokenType.BackgroundColor
                Return tokens.BackgroundColor
            Case DesignTokens.TokenType.TextColor
                Return tokens.TextColor
            Case DesignTokens.TokenType.BorderColor
                Return tokens.BorderColor
            Case Else
                Return Color.Empty
        End Select
    End Function
    
    Public Sub ApplyTokensToAllControls()
        For Each kvp In _tokenMappings
            Dim control As Control = kvp.Key
            Dim mapping As ControlTokenMapping = kvp.Value
            
            If mapping.BackColorToken <> DesignTokens.TokenType.None Then
                ApplyToken(control, mapping.BackColorToken, True)
            End If
            
            If mapping.ForeColorToken <> DesignTokens.TokenType.None Then
                ApplyToken(control, mapping.ForeColorToken, False)
            End If
        Next
    End Sub
    
    Protected Overrides Sub Dispose(disposing As Boolean)
        If disposing Then
            RemoveHandler GlobalDesignTokens.Instance.TokensChanged, AddressOf OnGlobalTokensChanged
        End If
        MyBase.Dispose(disposing)
    End Sub
    
    Private Class ControlTokenMapping
        Public Property BackColorToken As DesignTokens.TokenType = DesignTokens.TokenType.None
        Public Property ForeColorToken As DesignTokens.TokenType = DesignTokens.TokenType.None
    End Class
End Class
```

## 4. グローバルトークン設定フォーム

```vb
Imports System.Drawing
Imports System.Windows.Forms

Public Class GlobalTokenSettingsForm
    Private Sub GlobalTokenSettingsForm_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        ' 現在のトークンを読み込み
        LoadCurrentTokens()
    End Sub
    
    Private Sub LoadCurrentTokens()
        Dim tokens = GlobalDesignTokens.Instance.Tokens
        
        ' カラーピッカーなどのコントロールに値を設定
        ' （実装例：ButtonやPanelのBackColorで表現）
        PanelPrimaryColor.BackColor = tokens.PrimaryColor
        PanelSecondaryColor.BackColor = tokens.SecondaryColor
        PanelBackgroundColor.BackColor = tokens.BackgroundColor
        PanelTextColor.BackColor = tokens.TextColor
        PanelBorderColor.BackColor = tokens.BorderColor
    End Sub
    
    Private Sub ButtonChangePrimaryColor_Click(sender As Object, e As EventArgs) Handles ButtonChangePrimaryColor.Click
        Using dialog As New ColorDialog()
            dialog.Color = GlobalDesignTokens.Instance.Tokens.PrimaryColor
            If dialog.ShowDialog() = DialogResult.OK Then
                GlobalDesignTokens.Instance.UpdateToken(DesignTokens.TokenType.PrimaryColor, dialog.Color)
                PanelPrimaryColor.BackColor = dialog.Color
            End If
        End Using
    End Sub
    
    ' 他の色についても同様のボタンハンドラーを実装
    
    Private Sub ButtonSave_Click(sender As Object, e As EventArgs) Handles ButtonSave.Click
        GlobalDesignTokens.Instance.SaveToFile()
        MessageBox.Show("デザイントークンを保存しました。", "保存完了", MessageBoxButtons.OK, MessageBoxIcon.Information)
    End Sub
    
    Private Sub ButtonLoad_Click(sender As Object, e As EventArgs) Handles ButtonLoad.Click
        GlobalDesignTokens.Instance.LoadFromFile()
        LoadCurrentTokens()
        MessageBox.Show("デザイントークンを読み込みました。", "読込完了", MessageBoxButtons.OK, MessageBoxIcon.Information)
    End Sub
End Class
```

## 5. 使い方

### アプリケーション起動時

```vb
' Program.vbまたはメインフォームのLoadイベント
Sub Main()
    Application.EnableVisualStyles()
    Application.SetCompatibleTextRenderingDefault(False)
    
    ' グローバルトークンを初期化（ファイルから読み込み）
    GlobalDesignTokens.Instance.LoadFromFile()
    
    Application.Run(New MainForm())
End Sub
```

### 各フォーム・ユーザーコントロール

1. `DesignTokenManager`をフォームに配置
2. `UseGlobalTokens`を`True`に設定（デフォルト）
3. 各コントロールに`BackColorToken`/`ForeColorToken`を設定

### グローバルトークンの変更

```vb
' どのフォームからでも変更可能
GlobalDesignTokens.Instance.UpdateToken(DesignTokens.TokenType.PrimaryColor, Color.Blue)

' または設定フォームを表示
Dim settingsForm As New GlobalTokenSettingsForm()
settingsForm.ShowDialog()
```

この実装により、アプリケーション全体でデザイントークンが共有され、一箇所の変更が全フォーム・コントロールに即座に反映されます。

# おわりに
最近デザイントークンというものを知ったので、今回はデザイナー上でデザイントークンを管理できるカスタムコントロールを作ってみました。

他にも各コントロールにデザイントークンを反映させる方法があると思うので、今後も色々試していきます。
