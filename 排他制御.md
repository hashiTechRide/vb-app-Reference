ステートパターンを使用していて、カスタムコントロールごとにロック対象が異なる場合、設計を見直す必要がありますね。

## 改良した設計

### 1. ロック情報を抽象化

```vb.net
''' <summary>
''' ロック対象情報
''' </summary>
Public Class LockTarget
    Public Property TableName As String
    Public Property WhereClause As String
    Public Property Parameters As Dictionary(Of String, Object)
    
    Public Sub New(tableName As String, whereClause As String, parameters As Dictionary(Of String, Object))
        Me.TableName = tableName
        Me.WhereClause = whereClause
        Me.Parameters = parameters
    End Sub
End Class

''' <summary>
''' 編集可能なコントロールのインターフェース（拡張版）
''' </summary>
Public Interface IEditableControl
    ''' <summary>
    ''' ロック対象テーブル情報を取得
    ''' </summary>
    Function GetLockTargets() As List(Of LockTarget)
    
    ''' <summary>
    ''' 編集モード変更通知
    ''' </summary>
    Sub OnEditModeChanged(isEditMode As Boolean)
    
    ''' <summary>
    ''' 未保存変更チェック
    ''' </summary>
    Function HasUnsavedChanges() As Boolean
    
    ''' <summary>
    ''' データ再読み込み
    ''' </summary>
    Sub ReloadData()
End Interface
```

### 2. 複数テーブルロック対応のLockService

```vb.net
Public Class LockService
    Implements IDisposable

    Private _connection As OracleConnection
    Private _transaction As OracleTransaction
    Private _lockCommands As New List(Of OracleCommand)
    Private _isLocked As Boolean = False
    Private _lockTargets As List(Of LockTarget)

    Public Sub New(connectionString As String)
        _connection = New OracleConnection(connectionString)
    End Sub

    ''' <summary>
    ''' 複数テーブルの排他ロックを取得
    ''' </summary>
    Public Function AcquireLocks(lockTargets As List(Of LockTarget)) As Boolean
        If lockTargets Is Nothing OrElse lockTargets.Count = 0 Then
            Return False
        End If

        Try
            If _connection.State <> ConnectionState.Open Then
                _connection.Open()
            End If

            ' トランザクション開始
            _transaction = _connection.BeginTransaction()
            _lockTargets = lockTargets
            _lockCommands.Clear()

            ' 各テーブルに対してロック取得
            For Each target In lockTargets
                Dim sql As String = $"SELECT * FROM {target.TableName} WHERE {target.WhereClause} FOR UPDATE NOWAIT"
                Dim cmd As New OracleCommand(sql, _connection, _transaction)

                ' パラメータ設定
                If target.Parameters IsNot Nothing Then
                    For Each param In target.Parameters
                        cmd.Parameters.Add(New OracleParameter(param.Key, param.Value))
                    Next
                End If

                ' ロック取得試行
                Dim reader As OracleDataReader = cmd.ExecuteReader()
                If Not reader.HasRows Then
                    ' レコードが存在しない
                    reader.Close()
                    ReleaseLock()
                    MessageBox.Show($"テーブル '{target.TableName}' に対象レコードが存在しません。", 
                                    "エラー", MessageBoxButtons.OK, MessageBoxIcon.Warning)
                    Return False
                End If
                reader.Close()

                _lockCommands.Add(cmd)
            Next

            _isLocked = True
            Return True

        Catch ex As OracleException
            ' ORA-00054: resource busy and acquire with NOWAIT specified
            If ex.Number = 54 Then
                MessageBox.Show("対象レコードは他のユーザーが編集中です。", 
                                "ロックエラー", MessageBoxButtons.OK, MessageBoxIcon.Warning)
            Else
                MessageBox.Show($"ロック取得エラー: {ex.Message}", 
                                "エラー", MessageBoxButtons.OK, MessageBoxIcon.Error)
            End If
            ReleaseLock()
            Return False
        Catch ex As Exception
            MessageBox.Show($"予期しないエラー: {ex.Message}", 
                            "エラー", MessageBoxButtons.OK, MessageBoxIcon.Error)
            ReleaseLock()
            Return False
        End Try
    End Function

    ''' <summary>
    ''' 排他ロックを解放
    ''' </summary>
    Public Sub ReleaseLock()
        Try
            If _isLocked AndAlso _transaction IsNot Nothing Then
                _transaction.Rollback()
                _isLocked = False
            End If
        Catch ex As Exception
            ' ログ出力など
            Debug.WriteLine($"ReleaseLock Error: {ex.Message}")
        Finally
            For Each cmd In _lockCommands
                cmd?.Dispose()
            Next
            _lockCommands.Clear()

            If _transaction IsNot Nothing Then
                _transaction.Dispose()
                _transaction = Nothing
            End If
            
            _lockTargets = Nothing
        End Try
    End Sub

    ''' <summary>
    ''' データ更新（ロックを保持したまま）
    ''' </summary>
    Public Function UpdateData(sql As String, parameters As Dictionary(Of String, Object)) As Boolean
        If Not _isLocked Then
            Throw New InvalidOperationException("ロックが取得されていません。")
        End If

        Try
            Using cmd As New OracleCommand(sql, _connection, _transaction)
                If parameters IsNot Nothing Then
                    For Each param In parameters
                        cmd.Parameters.Add(New OracleParameter(param.Key, param.Value))
                    Next
                End If
                cmd.ExecuteNonQuery()
            End Using
            Return True
        Catch ex As Exception
            MessageBox.Show($"更新エラー: {ex.Message}", "エラー", MessageBoxButtons.OK, MessageBoxIcon.Error)
            Return False
        End Try
    End Function

    ''' <summary>
    ''' 複数SQL実行（トランザクション内）
    ''' </summary>
    Public Function ExecuteMultiple(sqlCommands As List(Of Tuple(Of String, Dictionary(Of String, Object)))) As Boolean
        If Not _isLocked Then
            Throw New InvalidOperationException("ロックが取得されていません。")
        End If

        Try
            For Each sqlCmd In sqlCommands
                Using cmd As New OracleCommand(sqlCmd.Item1, _connection, _transaction)
                    If sqlCmd.Item2 IsNot Nothing Then
                        For Each param In sqlCmd.Item2
                            cmd.Parameters.Add(New OracleParameter(param.Key, param.Value))
                        Next
                    End If
                    cmd.ExecuteNonQuery()
                End Using
            Next
            Return True
        Catch ex As Exception
            MessageBox.Show($"更新エラー: {ex.Message}", "エラー", MessageBoxButtons.OK, MessageBoxIcon.Error)
            Return False
        End Try
    End Function

    ''' <summary>
    ''' トランザクションをコミット
    ''' </summary>
    Public Sub Commit()
        If _isLocked AndAlso _transaction IsNot Nothing Then
            _transaction.Commit()
            _isLocked = False
        End If
    End Sub

    ''' <summary>
    ''' 現在のロック対象情報を取得
    ''' </summary>
    Public ReadOnly Property CurrentLockTargets As List(Of LockTarget)
        Get
            Return _lockTargets
        End Get
    End Property

    Public ReadOnly Property IsLocked As Boolean
        Get
            Return _isLocked
        End Get
    End Property

    Public Sub Dispose() Implements IDisposable.Dispose
        ReleaseLock()
        If _connection IsNot Nothing Then
            If _connection.State = ConnectionState.Open Then
                _connection.Close()
            End If
            _connection.Dispose()
        End If
    End Sub
End Class
```

### 3. ステートパターンのStateクラス

```vb.net
''' <summary>
''' State基底クラス
''' </summary>
Public MustInherit Class EditControlState
    Protected _context As EditStateContext
    
    Public Sub New(context As EditStateContext)
        _context = context
    End Sub
    
    Public MustOverride Sub LoadControl()
    Public MustOverride Sub UnloadControl()
End Class

''' <summary>
''' Stateコンテキスト
''' </summary>
Public Class EditStateContext
    Private _currentState As EditControlState
    Private _currentControl As UserControl
    Private _panel As Panel
    Private _parentForm As MainEditForm
    
    Public Sub New(panel As Panel, parentForm As MainEditForm)
        _panel = panel
        _parentForm = parentForm
    End Sub
    
    Public Property CurrentState As EditControlState
        Get
            Return _currentState
        End Get
        Set(value As EditControlState)
            ' 現在のコントロールをアンロード
            _currentState?.UnloadControl()
            
            ' 新しいStateに切り替え
            _currentState = value
            _currentState?.LoadControl()
        End Set
    End Property
    
    Public Property CurrentControl As UserControl
        Get
            Return _currentControl
        End Get
        Set(value As UserControl)
            ' 既存コントロールを削除
            If _currentControl IsNot Nothing Then
                _panel.Controls.Remove(_currentControl)
                _currentControl.Dispose()
            End If
            
            ' 新しいコントロールを追加
            _currentControl = value
            If _currentControl IsNot Nothing Then
                _currentControl.Dock = DockStyle.Fill
                _panel.Controls.Add(_currentControl)
            End If
        End Set
    End Property
    
    Public ReadOnly Property Panel As Panel
        Get
            Return _panel
        End Get
    End Property
    
    Public ReadOnly Property ParentForm As MainEditForm
        Get
            Return _parentForm
        End Get
    End Property
End Class

''' <summary>
''' 基本情報タブのState
''' </summary>
Public Class EmployeeBasicState
    Inherits EditControlState
    
    Public Sub New(context As EditStateContext)
        MyBase.New(context)
    End Sub
    
    Public Overrides Sub LoadControl()
        Dim control As New EmployeeBasicControl()
        _context.CurrentControl = control
    End Sub
    
    Public Overrides Sub UnloadControl()
        ' クリーンアップ処理
    End Sub
End Class

''' <summary>
''' 詳細情報タブのState
''' </summary>
Public Class EmployeeDetailState
    Inherits EditControlState
    
    Public Sub New(context As EditStateContext)
        MyBase.New(context)
    End Sub
    
    Public Overrides Sub LoadControl()
        Dim control As New EmployeeDetailControl()
        _context.CurrentControl = control
    End Sub
    
    Public Overrides Sub UnloadControl()
        ' クリーンアップ処理
    End Sub
End Class

''' <summary>
''' 給与情報タブのState（複数テーブル）
''' </summary>
Public Class EmployeeSalaryState
    Inherits EditControlState
    
    Public Sub New(context As EditStateContext)
        MyBase.New(context)
    End Sub
    
    Public Overrides Sub LoadControl()
        Dim control As New EmployeeSalaryControl()
        _context.CurrentControl = control
    End Sub
    
    Public Overrides Sub UnloadControl()
        ' クリーンアップ処理
    End Sub
End Class
```

### 4. フォーム側の実装（ステートパターン対応）

```vb.net
Public Class MainEditForm
    Inherits Form

    Private _lockService As LockService
    Private _recordId As Integer
    Private _isEditMode As Boolean = False
    Private _stateContext As EditStateContext
    
    Public Sub New(recordId As Integer)
        InitializeComponent()
        _recordId = recordId
        _lockService = New LockService(ConfigurationManager.ConnectionStrings("OracleDB").ConnectionString)
        _stateContext = New EditStateContext(panelContent, Me)
    End Sub

    Private Sub MainEditForm_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        ' 初期タブ表示
        _stateContext.CurrentState = New EmployeeBasicState(_stateContext)
    End Sub

    Public ReadOnly Property IsEditMode As Boolean
        Get
            Return _isEditMode
        End Get
    End Property

    Public ReadOnly Property LockService As LockService
        Get
            Return _lockService
        End Get
    End Property

    Public ReadOnly Property RecordId As Integer
        Get
            Return _recordId
        End Get
    End Property

    ''' <summary>
    ''' ロックボタンクリック
    ''' </summary>
    Private Sub btnLock_Click(sender As Object, e As EventArgs) Handles btnLock.Click
        If Not _isEditMode Then
            ' ロック取得
            AcquireLock()
        Else
            ' ロック解放
            ReleaseLockWithConfirmation()
        End If
    End Sub

    ''' <summary>
    ''' ロック取得処理
    ''' </summary>
    Private Sub AcquireLock()
        ' 現在のコントロールからロック対象情報を取得
        Dim editableControl As IEditableControl = TryCast(_stateContext.CurrentControl, IEditableControl)
        If editableControl Is Nothing Then
            MessageBox.Show("このタブはロックをサポートしていません。", "警告", 
                            MessageBoxButtons.OK, MessageBoxIcon.Warning)
            Return
        End If

        Dim lockTargets As List(Of LockTarget) = editableControl.GetLockTargets()
        If lockTargets Is Nothing OrElse lockTargets.Count = 0 Then
            MessageBox.Show("ロック対象が指定されていません。", "警告", 
                            MessageBoxButtons.OK, MessageBoxIcon.Warning)
            Return
        End If

        ' ロック取得
        If _lockService.AcquireLocks(lockTargets) Then
            _isEditMode = True
            UpdateLockUI()
            NotifyEditModeChanged()
            
            Dim tableNames As String = String.Join(", ", lockTargets.Select(Function(t) t.TableName))
            MessageBox.Show($"ロックを取得しました。{vbCrLf}対象: {tableNames}", 
                            "情報", MessageBoxButtons.OK, MessageBoxIcon.Information)
        End If
    End Sub

    ''' <summary>
    ''' ロック解放処理（確認付き）
    ''' </summary>
    Private Sub ReleaseLockWithConfirmation()
        If HasUnsavedChanges() Then
            Dim result As DialogResult = MessageBox.Show(
                "未保存の変更があります。破棄してロックを解除しますか？",
                "確認",
                MessageBoxButtons.YesNo,
                MessageBoxIcon.Question)
            
            If result = DialogResult.No Then
                Return
            End If
        End If

        _lockService.ReleaseLock()
        _isEditMode = False
        UpdateLockUI()
        NotifyEditModeChanged()
        MessageBox.Show("ロックを解除しました。", "情報", MessageBoxButtons.OK, MessageBoxIcon.Information)
    End Sub

    Private Sub UpdateLockUI()
        btnLock.Text = If(_isEditMode, "ロック解除", "ロック取得")
        btnLock.BackColor = If(_isEditMode, Color.LightCoral, Color.LightGreen)
        
        ' ロック中はタブ切替を制限（任意）
        btnTab1.Enabled = Not _isEditMode
        btnTab2.Enabled = Not _isEditMode
        btnTab3.Enabled = Not _isEditMode
    End Sub

    Private Sub NotifyEditModeChanged()
        Dim editableControl As IEditableControl = TryCast(_stateContext.CurrentControl, IEditableControl)
        editableControl?.OnEditModeChanged(_isEditMode)
    End Sub

    Private Function HasUnsavedChanges() As Boolean
        Dim editableControl As IEditableControl = TryCast(_stateContext.CurrentControl, IEditableControl)
        Return If(editableControl?.HasUnsavedChanges(), False)
    End Function

    ''' <summary>
    ''' タブ切り替え（ステートパターン）
    ''' </summary>
    Private Sub btnTab1_Click(sender As Object, e As EventArgs) Handles btnTab1.Click
        If _isEditMode Then
            MessageBox.Show("ロック解除後にタブを切り替えてください。", "警告", 
                            MessageBoxButtons.OK, MessageBoxIcon.Warning)
            Return
        End If
        
        _stateContext.CurrentState = New EmployeeBasicState(_stateContext)
        UpdateTabButtonUI("Tab1")
    End Sub

    Private Sub btnTab2_Click(sender As Object, e As EventArgs) Handles btnTab2.Click
        If _isEditMode Then
            MessageBox.Show("ロック解除後にタブを切り替えてください。", "警告", 
                            MessageBoxButtons.OK, MessageBoxIcon.Warning)
            Return
        End If
        
        _stateContext.CurrentState = New EmployeeDetailState(_stateContext)
        UpdateTabButtonUI("Tab2")
    End Sub

    Private Sub btnTab3_Click(sender As Object, e As EventArgs) Handles btnTab3.Click
        If _isEditMode Then
            MessageBox.Show("ロック解除後にタブを切り替えてください。", "警告", 
                            MessageBoxButtons.OK, MessageBoxIcon.Warning)
            Return
        End If
        
        _stateContext.CurrentState = New EmployeeSalaryState(_stateContext)
        UpdateTabButtonUI("Tab3")
    End Sub

    Private Sub UpdateTabButtonUI(activeTab As String)
        btnTab1.BackColor = If(activeTab = "Tab1", SystemColors.ActiveCaption, SystemColors.Control)
        btnTab2.BackColor = If(activeTab = "Tab2", SystemColors.ActiveCaption, SystemColors.Control)
        btnTab3.BackColor = If(activeTab = "Tab3", SystemColors.ActiveCaption, SystemColors.Control)
    End Sub

    Protected Overrides Sub OnFormClosing(e As FormClosingEventArgs)
        If _isEditMode Then
            Dim result As DialogResult = MessageBox.Show(
                "ロックを取得中です。終了してよろしいですか？",
                "確認",
                MessageBoxButtons.YesNo,
                MessageBoxIcon.Question)

            If result = DialogResult.No Then
                e.Cancel = True
                Return
            End If
        End If

        _lockService?.Dispose()
        MyBase.OnFormClosing(e)
    End Sub
End Class
```

### 5. カスタムコントロール実装例

#### 基本情報（単一テーブル）

```vb.net
Public Class EmployeeBasicControl
    Inherits UserControl
    Implements IEditableControl

    Private _parentForm As MainEditForm
    Private _isDirty As Boolean = False

    Private Sub EmployeeBasicControl_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        _parentForm = TryCast(Me.FindForm(), MainEditForm)
        LoadData()
        OnEditModeChanged(_parentForm.IsEditMode)
    End Sub

    ''' <summary>
    ''' ロック対象テーブル情報を返す
    ''' </summary>
    Public Function GetLockTargets() As List(Of LockTarget) Implements IEditableControl.GetLockTargets
        Dim targets As New List(Of LockTarget)
        
        ' 単一テーブルのロック
        targets.Add(New LockTarget(
            "EMPLOYEES",
            "EMPLOYEE_ID = :id",
            New Dictionary(Of String, Object) From {{"id", _parentForm.RecordId}}
        ))
        
        Return targets
    End Function

    Private Sub LoadData()
        Using conn As New OracleConnection(ConfigurationManager.ConnectionStrings("OracleDB").ConnectionString)
            conn.Open()
            Dim sql As String = "SELECT * FROM EMPLOYEES WHERE EMPLOYEE_ID = :id"
            Using cmd As New OracleCommand(sql, conn)
                cmd.Parameters.Add(New OracleParameter("id", _parentForm.RecordId))
                Using reader As OracleDataReader = cmd.ExecuteReader()
                    If reader.Read() Then
                        txtName.Text = reader("EMPLOYEE_NAME").ToString()
                        txtEmail.Text = reader("EMAIL").ToString()
                    End If
                End Using
            End Using
        End Using
        _isDirty = False
    End Sub

    Public Sub OnEditModeChanged(isEditMode As Boolean) Implements IEditableControl.OnEditModeChanged
        txtName.ReadOnly = Not isEditMode
        txtEmail.ReadOnly = Not isEditMode
        btnSave.Enabled = isEditMode
        
        If Not isEditMode Then
            LoadData()
        End If
    End Sub

    Public Function HasUnsavedChanges() As Boolean Implements IEditableControl.HasUnsavedChanges
        Return _isDirty
    End Function

    Public Sub ReloadData() Implements IEditableControl.ReloadData
        LoadData()
    End Sub

    Private Sub txt_TextChanged(sender As Object, e As EventArgs) Handles txtName.TextChanged, txtEmail.TextChanged
        If _parentForm IsNot Nothing AndAlso _parentForm.IsEditMode Then
            _isDirty = True
        End If
    End Sub

    Private Sub btnSave_Click(sender As Object, e As EventArgs) Handles btnSave.Click
        If Not _parentForm.IsEditMode Then
            Return
        End If

        Dim sql As String = "UPDATE EMPLOYEES SET EMPLOYEE_NAME = :name, EMAIL = :email WHERE EMPLOYEE_ID = :id"
        Dim parameters As New Dictionary(Of String, Object) From {
            {"name", txtName.Text.Trim()},
            {"email", txtEmail.Text.Trim()},
            {"id", _parentForm.RecordId}
        }

        If _parentForm.LockService.UpdateData(sql, parameters) Then
            _parentForm.LockService.Commit()
            _isDirty = False
            MessageBox.Show("保存しました。", "完了", MessageBoxButtons.OK, MessageBoxIcon.Information)
        End If
    End Sub
End Class
```

#### 給与情報（複数テーブル）

```vb.net
Public Class EmployeeSalaryControl
    Inherits UserControl
    Implements IEditableControl

    Private _parentForm As MainEditForm
    Private _isDirty As Boolean = False

    Private Sub EmployeeSalaryControl_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        _parentForm = TryCast(Me.FindForm(), MainEditForm)
        LoadData()
        OnEditModeChanged(_parentForm.IsEditMode)
    End Sub

    ''' <summary>
    ''' 複数テーブルのロック対象情報を返す
    ''' </summary>
    Public Function GetLockTargets() As List(Of LockTarget) Implements IEditableControl.GetLockTargets
        Dim targets As New List(Of LockTarget)
        
        ' EMPLOYEES テーブル
        targets.Add(New LockTarget(
            "EMPLOYEES",
            "EMPLOYEE_ID = :id",
            New Dictionary(Of String, Object) From {{"id", _parentForm.RecordId}}
        ))
        
        ' SALARIES テーブル
        targets.Add(New LockTarget(
            "SALARIES",
            "EMPLOYEE_ID = :id",
            New Dictionary(Of String, Object) From {{"id", _parentForm.RecordId}}
        ))
        
        ' ALLOWANCES テーブル
        targets.Add(New LockTarget(
            "ALLOWANCES",
            "EMPLOYEE_ID = :id",
            New Dictionary(Of String, Object) From {{"id", _parentForm.RecordId}}
        ))
        
        Return targets
    End Function

    Private Sub LoadData()
        Using conn As New OracleConnection(ConfigurationManager.ConnectionStrings("OracleDB").ConnectionString)
            conn.Open()
            
            ' 複数テーブルからデータ取得
            Dim sql As String = @"
                SELECT 
                    e.EMPLOYEE_NAME,
                    s.BASE_SALARY,
                    s.BONUS,
                    a.TRANSPORT_ALLOWANCE,
                    a.HOUSING_ALLOWANCE
                FROM EMPLOYEES e
                LEFT JOIN SALARIES s ON e.EMPLOYEE_ID = s.EMPLOYEE_ID
                LEFT JOIN ALLOWANCES a ON e.EMPLOYEE_ID = a.EMPLOYEE_ID
                WHERE e.EMPLOYEE_ID = :id"
                
            Using cmd As New OracleCommand(sql, conn)
                cmd.Parameters.Add(New OracleParameter("id", _parentForm.RecordId))
                Using reader As OracleDataReader = cmd.ExecuteReader()
                    If reader.Read() Then
                        lblName.Text = reader("EMPLOYEE_NAME").ToString()
                        txtBaseSalary.Text = reader("BASE_SALARY").ToString()
                        txtBonus.Text = reader("BONUS").ToString()
                        txtTransport.Text = reader("TRANSPORT_ALLOWANCE").ToString()
                        txtHousing.Text = reader("HOUSING_ALLOWANCE").ToString()
                    End If
                End Using
            End Using
        End Using
        _isDirty = False
    End Sub

    Public Sub OnEditModeChanged(isEditMode As Boolean) Implements IEditableControl.OnEditModeChanged
        txtBaseSalary.ReadOnly = Not isEditMode
        txtBonus.ReadOnly = Not isEditMode
        txtTransport.ReadOnly = Not isEditMode
        txtHousing.ReadOnly = Not isEditMode
        btnSave.Enabled = isEditMode
        
        If Not isEditMode Then
            LoadData()
        End If
    End Sub

    Public Function HasUnsavedChanges() As Boolean Implements IEditableControl.HasUnsavedChanges
        Return _isDirty
    End Function

    Public Sub ReloadData() Implements IEditableControl.ReloadData
        LoadData()
    End Sub

    Private Sub txt_TextChanged(sender As Object, e As EventArgs) Handles txtBaseSalary.TextChanged, txtBonus.TextChanged, txtTransport.TextChanged, txtHousing.TextChanged
        If _parentForm IsNot Nothing AndAlso _parentForm.IsEditMode Then
            _isDirty = True
        End If
    End Sub

    Private Sub btnSave_Click(sender As Object, e As EventArgs) Handles btnSave.Click
        If Not _parentForm.IsEditMode Then
            Return
        End If

        ' 複数テーブルの更新SQL
        Dim sqlCommands As New List(Of Tuple(Of String, Dictionary(Of String, Object)))
        
        ' SALARIES更新
        sqlCommands.Add(New Tuple(Of String, Dictionary(Of String, Object))(
            "UPDATE SALARIES SET BASE_SALARY = :base, BONUS = :bonus WHERE EMPLOYEE_ID = :id",
            New Dictionary(Of String, Object) From {
                {"base", Decimal.Parse(txtBaseSalary.Text)},
                {"bonus", Decimal.Parse(txtBonus.Text)},
                {"id", _parentForm.RecordId}
            }
        ))
        
        ' ALLOWANCES更新
        sqlCommands.Add(New Tuple(Of String, Dictionary(Of String, Object))(
            "UPDATE ALLOWANCES SET TRANSPORT_ALLOWANCE = :transport, HOUSING_ALLOWANCE = :housing WHERE EMPLOYEE_ID = :id",
            New Dictionary(Of String, Object) From {
                {"transport", Decimal.Parse(txtTransport.Text)},
                {"housing", Decimal.Parse(txtHousing.Text)},
                {"id", _parentForm.RecordId}
            }
        ))

        If _parentForm.LockService.ExecuteMultiple(sqlCommands) Then
            _parentForm.LockService.Commit()
            _isDirty = False
            MessageBox.Show("保存しました。", "完了", MessageBoxButtons.OK, MessageBoxIcon.Information)
        End If
    End Sub
End Class
```

## この設計の特徴

1. **柔軟なロック対象**: 各カスタムコントロールが`GetLockTargets()`で独自のロック対象を定義
2. **ステートパターン統合**: Stateクラスでコントロールの切り替えを管理
3. **複数テーブル対応**: `LockService`が複数テーブルの同時ロックをサポート
4. **一元管理**: フォームがロック状態を統括し、各コントロールは自身のロック要件のみを定義

この設計により、各タブで異なるテーブルや行数のロックが必要な場合でも、拡張性と保守性を保ちながら実装できます。