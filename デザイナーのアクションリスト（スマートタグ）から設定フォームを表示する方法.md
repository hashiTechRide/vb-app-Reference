## はじめに

WinFormsでカスタムコントロールを作成する際、複雑な設定を行いやすくするために、デザイナーのアクションリスト（スマートタグ）から専用の設定フォームを表示させることができます。

本記事では、スマートタグのメニューから設定ダイアログを開く実装方法を、基本から応用まで解説します。

### 開発環境
- 開発対象: .NET Framework 4.8
- 開発言語: VB.NET

### 完成イメージ

デザイナー上でコントロールを選択すると表示されるスマートタグから「詳細設定を開く...」を選択すると、専用の設定フォームが表示されます。

## 1. 基本実装

まずは、シンプルな設定フォームを表示する基本的な実装から始めます。

### 1-1. カスタムコントロールの作成

```vb
Imports System.ComponentModel
Imports System.ComponentModel.Design
Imports System.Windows.Forms

<Designer(GetType(CustomButtonDesigner))>
Public Class CustomButton
    Inherits Button
    
    Private _settingValue As String = ""
    Private _timeout As Integer = 1000
    Private _connectionString As String = ""
    
    <Category("カスタム設定")>
    <Description("カスタム設定値")>
    Public Property SettingValue As String
        Get
            Return _settingValue
        End Get
        Set(value As String)
            _settingValue = value
        End Set
    End Property
    
    <Category("カスタム設定")>
    <Description("タイムアウト時間（ミリ秒）")>
    Public Property Timeout As Integer
        Get
            Return _timeout
        End Get
        Set(value As Integer)
            _timeout = value
        End Set
    End Property
    
    <Category("カスタム設定")>
    <Description("接続文字列")>
    Public Property ConnectionString As String
        Get
            Return _connectionString
        End Get
        Set(value As String)
            _connectionString = value
        End Set
    End Property
End Class
```

### 1-2. デザイナークラスの作成

```vb
Imports System.ComponentModel.Design
Imports System.Windows.Forms.Design

Public Class CustomButtonDesigner
    Inherits ControlDesigner
    
    Public Overrides ReadOnly Property ActionLists As DesignerActionListCollection
        Get
            Dim actionLists As New DesignerActionListCollection()
            actionLists.Add(New CustomButtonActionList(Me.Component))
            Return actionLists
        End Get
    End Property
End Class
```

### 1-3. アクションリストクラスの作成

```vb
Imports System.ComponentModel
Imports System.ComponentModel.Design
Imports System.Windows.Forms

Public Class CustomButtonActionList
    Inherits DesignerActionList
    
    Private _button As CustomButton
    
    Public Sub New(component As IComponent)
        MyBase.New(component)
        _button = CType(component, CustomButton)
    End Sub
    
    Public Overrides Function GetSortedActionItems() As DesignerActionItemCollection
        Dim items As New DesignerActionItemCollection()
        
        ' ヘッダー
        items.Add(New DesignerActionHeaderItem("設定"))
        
        ' 設定フォームを開くメソッドアイテム
        items.Add(New DesignerActionMethodItem(
            Me,
            "OpenSettingsForm",
            "詳細設定を開く...",
            "設定",
            "詳細な設定を行うためのダイアログを開きます",
            True
        ))
        
        ' インライン編集用プロパティアイテム
        items.Add(New DesignerActionPropertyItem("SettingValue", "設定値", "設定", "簡易設定値"))
        
        Return items
    End Function
    
    ' 設定フォームを開くメソッド
    Public Sub OpenSettingsForm()
        Using settingsForm As New SettingsForm(_button)
            If settingsForm.ShowDialog() = DialogResult.OK Then
                ' 変更を通知（Undo/Redoを機能させるため）
                Dim properties = TypeDescriptor.GetProperties(_button)
                
                ' 各プロパティに値を設定
                If settingsForm.SettingValue <> _button.SettingValue Then
                    properties("SettingValue").SetValue(_button, settingsForm.SettingValue)
                End If
                
                If settingsForm.Timeout <> _button.Timeout Then
                    properties("Timeout").SetValue(_button, settingsForm.Timeout)
                End If
                
                If settingsForm.ConnectionString <> _button.ConnectionString Then
                    properties("ConnectionString").SetValue(_button, settingsForm.ConnectionString)
                End If
            End If
        End Using
    End Sub
    
    ' インライン編集用プロパティ
    Public Property SettingValue As String
        Get
            Return _button.SettingValue
        End Get
        Set(value As String)
            GetPropertyByName("SettingValue").SetValue(_button, value)
        End Set
    End Property
    
    Private Function GetPropertyByName(propName As String) As PropertyDescriptor
        Return TypeDescriptor.GetProperties(_button)(propName)
    End Function
End Class
```

### 1-4. 設定フォームの作成

```vb
Imports System.Windows.Forms

Public Class SettingsForm
    Inherits Form
    
    Private _button As CustomButton
    Private txtSettingValue As TextBox
    Private numTimeout As NumericUpDown
    Private txtConnectionString As TextBox
    Private btnOK As Button
    Private btnCancel As Button
    
    ' 変更された値を保持するプロパティ
    Public Property SettingValue As String
    Public Property Timeout As Integer
    Public Property ConnectionString As String
    
    Public Sub New(button As CustomButton)
        _button = button
        InitializeComponents()
        LoadCurrentSettings()
    End Sub
    
    Private Sub InitializeComponents()
        Me.Text = "詳細設定"
        Me.Size = New Size(450, 250)
        Me.StartPosition = FormStartPosition.CenterParent
        Me.FormBorderStyle = FormBorderStyle.FixedDialog
        Me.MaximizeBox = False
        Me.MinimizeBox = False
        
        Dim yPos As Integer = 20
        
        ' 設定値
        AddLabel("設定値:", 20, yPos)
        txtSettingValue = New TextBox()
        txtSettingValue.Location = New Point(120, yPos)
        txtSettingValue.Size = New Size(300, 20)
        Me.Controls.Add(txtSettingValue)
        yPos += 35
        
        ' タイムアウト
        AddLabel("タイムアウト (ms):", 20, yPos)
        numTimeout = New NumericUpDown()
        numTimeout.Location = New Point(120, yPos)
        numTimeout.Size = New Size(100, 20)
        numTimeout.Minimum = 0
        numTimeout.Maximum = 60000
        numTimeout.Increment = 100
        Me.Controls.Add(numTimeout)
        yPos += 35
        
        ' 接続文字列
        AddLabel("接続文字列:", 20, yPos)
        txtConnectionString = New TextBox()
        txtConnectionString.Location = New Point(120, yPos)
        txtConnectionString.Size = New Size(300, 20)
        Me.Controls.Add(txtConnectionString)
        yPos += 50
        
        ' OKボタン
        btnOK = New Button()
        btnOK.Text = "OK"
        btnOK.Location = New Point(260, yPos)
        btnOK.Size = New Size(75, 23)
        btnOK.DialogResult = DialogResult.OK
        AddHandler btnOK.Click, AddressOf BtnOK_Click
        Me.Controls.Add(btnOK)
        Me.AcceptButton = btnOK
        
        ' キャンセルボタン
        btnCancel = New Button()
        btnCancel.Text = "キャンセル"
        btnCancel.Location = New Point(345, yPos)
        btnCancel.Size = New Size(75, 23)
        btnCancel.DialogResult = DialogResult.Cancel
        Me.Controls.Add(btnCancel)
        Me.CancelButton = btnCancel
    End Sub
    
    Private Sub AddLabel(text As String, x As Integer, y As Integer)
        Dim lbl As New Label()
        lbl.Text = text
        lbl.Location = New Point(x, y + 3)
        lbl.AutoSize = True
        Me.Controls.Add(lbl)
    End Sub
    
    Private Sub LoadCurrentSettings()
        ' 現在の設定を読み込む
        txtSettingValue.Text = _button.SettingValue
        numTimeout.Value = _button.Timeout
        txtConnectionString.Text = _button.ConnectionString
    End Sub
    
    Private Sub BtnOK_Click(sender As Object, e As EventArgs)
        ' 設定値を保存
        SettingValue = txtSettingValue.Text
        Timeout = CInt(numTimeout.Value)
        ConnectionString = txtConnectionString.Text
    End Sub
End Class
```

## 2. より高度な実装例

実際のプロジェクトでは、タブコントロールを使った複雑な設定フォームが必要になることがあります。

### 2-1. タブ付き設定フォーム

```vb
Public Class AdvancedSettingsForm
    Inherits Form
    
    Private _control As CustomControl
    Private tabControl As TabControl
    
    ' 基本設定タブ
    Private txtName As TextBox
    Private numTimeout As NumericUpDown
    Private chkEnabled As CheckBox
    
    ' 詳細設定タブ
    Private cmbMode As ComboBox
    Private txtConnectionString As TextBox
    Private numRetryCount As NumericUpDown
    
    Public Sub New(control As CustomControl)
        _control = control
        InitializeComponents()
        LoadSettings()
    End Sub
    
    Private Sub InitializeComponents()
        Me.Text = "詳細設定"
        Me.Size = New Size(500, 400)
        Me.StartPosition = FormStartPosition.CenterParent
        Me.FormBorderStyle = FormBorderStyle.FixedDialog
        Me.MaximizeBox = False
        Me.MinimizeBox = False
        
        ' タブコントロール
        tabControl = New TabControl()
        tabControl.Location = New Point(10, 10)
        tabControl.Size = New Size(465, 310)
        Me.Controls.Add(tabControl)
        
        ' 基本設定タブ
        Dim tabBasic As New TabPage("基本設定")
        CreateBasicTab(tabBasic)
        tabControl.TabPages.Add(tabBasic)
        
        ' 詳細設定タブ
        Dim tabAdvanced As New TabPage("詳細設定")
        CreateAdvancedTab(tabAdvanced)
        tabControl.TabPages.Add(tabAdvanced)
        
        ' ボタン
        Dim btnOK As New Button()
        btnOK.Text = "OK"
        btnOK.Location = New Point(315, 330)
        btnOK.Size = New Size(75, 23)
        btnOK.DialogResult = DialogResult.OK
        AddHandler btnOK.Click, AddressOf BtnOK_Click
        Me.Controls.Add(btnOK)
        Me.AcceptButton = btnOK
        
        Dim btnCancel As New Button()
        btnCancel.Text = "キャンセル"
        btnCancel.Location = New Point(400, 330)
        btnCancel.Size = New Size(75, 23)
        btnCancel.DialogResult = DialogResult.Cancel
        Me.Controls.Add(btnCancel)
        Me.CancelButton = btnCancel
    End Sub
    
    Private Sub CreateBasicTab(tab As TabPage)
        Dim yPos As Integer = 20
        
        ' 名前
        AddLabelToTab(tab, "名前:", 20, yPos)
        txtName = New TextBox()
        txtName.Location = New Point(120, yPos)
        txtName.Size = New Size(300, 20)
        tab.Controls.Add(txtName)
        yPos += 35
        
        ' タイムアウト
        AddLabelToTab(tab, "タイムアウト (ms):", 20, yPos)
        numTimeout = New NumericUpDown()
        numTimeout.Location = New Point(120, yPos)
        numTimeout.Size = New Size(100, 20)
        numTimeout.Minimum = 0
        numTimeout.Maximum = 60000
        numTimeout.Increment = 100
        tab.Controls.Add(numTimeout)
        yPos += 35
        
        ' 有効/無効
        chkEnabled = New CheckBox()
        chkEnabled.Text = "有効にする"
        chkEnabled.Location = New Point(120, yPos)
        chkEnabled.AutoSize = True
        tab.Controls.Add(chkEnabled)
    End Sub
    
    Private Sub CreateAdvancedTab(tab As TabPage)
        Dim yPos As Integer = 20
        
        ' モード
        AddLabelToTab(tab, "モード:", 20, yPos)
        cmbMode = New ComboBox()
        cmbMode.Location = New Point(120, yPos)
        cmbMode.Size = New Size(150, 20)
        cmbMode.DropDownStyle = ComboBoxStyle.DropDownList
        cmbMode.Items.AddRange(New String() {"自動", "手動", "詳細"})
        tab.Controls.Add(cmbMode)
        yPos += 35
        
        ' 接続文字列
        AddLabelToTab(tab, "接続文字列:", 20, yPos)
        txtConnectionString = New TextBox()
        txtConnectionString.Location = New Point(120, yPos)
        txtConnectionString.Size = New Size(300, 20)
        tab.Controls.Add(txtConnectionString)
        yPos += 35
        
        ' リトライ回数
        AddLabelToTab(tab, "リトライ回数:", 20, yPos)
        numRetryCount = New NumericUpDown()
        numRetryCount.Location = New Point(120, yPos)
        numRetryCount.Size = New Size(100, 20)
        numRetryCount.Minimum = 0
        numRetryCount.Maximum = 10
        tab.Controls.Add(numRetryCount)
    End Sub
    
    Private Sub AddLabelToTab(tab As TabPage, text As String, x As Integer, y As Integer)
        Dim lbl As New Label()
        lbl.Text = text
        lbl.Location = New Point(x, y + 3)
        lbl.AutoSize = True
        tab.Controls.Add(lbl)
    End Sub
    
    Private Sub LoadSettings()
        ' 基本設定
        txtName.Text = _control.ControlName
        numTimeout.Value = _control.Timeout
        chkEnabled.Checked = _control.IsEnabled
        
        ' 詳細設定
        cmbMode.SelectedIndex = _control.Mode
        txtConnectionString.Text = _control.ConnectionString
        numRetryCount.Value = _control.RetryCount
    End Sub
    
    Private Sub BtnOK_Click(sender As Object, e As EventArgs)
        ' 設定を保存
        Dim properties = TypeDescriptor.GetProperties(_control)
        
        ' 基本設定
        properties("ControlName").SetValue(_control, txtName.Text)
        properties("Timeout").SetValue(_control, CInt(numTimeout.Value))
        properties("IsEnabled").SetValue(_control, chkEnabled.Checked)
        
        ' 詳細設定
        properties("Mode").SetValue(_control, cmbMode.SelectedIndex)
        properties("ConnectionString").SetValue(_control, txtConnectionString.Text)
        properties("RetryCount").SetValue(_control, CInt(numRetryCount.Value))
    End Sub
End Class
```

### 2-2. カスタムコントロール（高度版）

```vb
<Designer(GetType(CustomControlDesigner))>
Public Class CustomControl
    Inherits Control
    
    Private _controlName As String = "Default"
    Private _timeout As Integer = 1000
    Private _isEnabled As Boolean = True
    Private _mode As Integer = 0
    Private _connectionString As String = ""
    Private _retryCount As Integer = 3
    
    <Category("基本設定")>
    <Description("コントロール名")>
    Public Property ControlName As String
        Get
            Return _controlName
        End Get
        Set(value As String)
            _controlName = value
            Me.Invalidate()
        End Set
    End Property
    
    <Category("基本設定")>
    <Description("タイムアウト時間（ミリ秒）")>
    Public Property Timeout As Integer
        Get
            Return _timeout
        End Get
        Set(value As Integer)
            _timeout = value
        End Set
    End Property
    
    <Category("基本設定")>
    <Description("コントロールを有効にするかどうか")>
    Public Property IsEnabled As Boolean
        Get
            Return _isEnabled
        End Get
        Set(value As Boolean)
            _isEnabled = value
            Me.Enabled = value
        End Set
    End Property
    
    <Category("詳細設定")>
    <Description("動作モード (0:自動, 1:手動, 2:詳細)")>
    Public Property Mode As Integer
        Get
            Return _mode
        End Get
        Set(value As Integer)
            If value >= 0 AndAlso value <= 2 Then
                _mode = value
            End If
        End Set
    End Property
    
    <Category("詳細設定")>
    <Description("データベース接続文字列")>
    Public Property ConnectionString As String
        Get
            Return _connectionString
        End Get
        Set(value As String)
            _connectionString = value
        End Set
    End Property
    
    <Category("詳細設定")>
    <Description("接続失敗時のリトライ回数")>
    Public Property RetryCount As Integer
        Get
            Return _retryCount
        End Get
        Set(value As Integer)
            _retryCount = value
        End Set
    End Property
    
    Protected Overrides Sub OnPaint(e As PaintEventArgs)
        MyBase.OnPaint(e)
        
        ' コントロール名を表示
        Using brush As New SolidBrush(Me.ForeColor)
            Dim sf As New StringFormat()
            sf.Alignment = StringAlignment.Center
            sf.LineAlignment = StringAlignment.Center
            e.Graphics.DrawString(_controlName, Me.Font, brush, Me.ClientRectangle, sf)
        End Using
    End Sub
End Class
```

## 3. バリデーション付き設定フォーム

入力値の検証を行う実装例です。

```vb
Public Class ValidatedSettingsForm
    Inherits Form
    
    Private _control As CustomControl
    Private txtName As TextBox
    Private numTimeout As NumericUpDown
    Private txtConnectionString As TextBox
    Private errorProvider As ErrorProvider
    
    Public Sub New(control As CustomControl)
        _control = control
        
        ' ErrorProviderの初期化
        errorProvider = New ErrorProvider()
        errorProvider.BlinkStyle = ErrorBlinkStyle.NeverBlink
        
        InitializeComponents()
        LoadSettings()
        
        ' バリデーションイベントの設定
        AddHandler txtName.Validating, AddressOf TxtName_Validating
        AddHandler txtConnectionString.Validating, AddressOf TxtConnectionString_Validating
    End Sub
    
    Private Sub TxtName_Validating(sender As Object, e As System.ComponentModel.CancelEventArgs)
        If String.IsNullOrWhiteSpace(txtName.Text) Then
            errorProvider.SetError(txtName, "名前は必須です")
            e.Cancel = True
        Else
            errorProvider.SetError(txtName, String.Empty)
        End If
    End Sub
    
    Private Sub TxtConnectionString_Validating(sender As Object, e As System.ComponentModel.CancelEventArgs)
        If Not String.IsNullOrWhiteSpace(txtConnectionString.Text) Then
            ' 簡易的な接続文字列の検証
            If Not txtConnectionString.Text.Contains("=") Then
                errorProvider.SetError(txtConnectionString, "接続文字列の形式が正しくありません")
                e.Cancel = True
                Return
            End If
        End If
        errorProvider.SetError(txtConnectionString, String.Empty)
    End Sub
    
    Private Sub BtnOK_Click(sender As Object, e As EventArgs)
        ' すべてのコントロールを検証
        If Not ValidateChildren() Then
            MessageBox.Show("入力内容に誤りがあります", "エラー", MessageBoxButtons.OK, MessageBoxIcon.Warning)
            Me.DialogResult = DialogResult.None
            Return
        End If
        
        ' 設定を保存
        SaveSettings()
    End Sub
    
    Private Sub SaveSettings()
        Dim properties = TypeDescriptor.GetProperties(_control)
        properties("ControlName").SetValue(_control, txtName.Text)
        properties("Timeout").SetValue(_control, CInt(numTimeout.Value))
        properties("ConnectionString").SetValue(_control, txtConnectionString.Text)
    End Sub
    
    Protected Overrides Sub Dispose(disposing As Boolean)
        If disposing Then
            If errorProvider IsNot Nothing Then
                errorProvider.Dispose()
            End If
        End If
        MyBase.Dispose(disposing)
    End Sub
End Class
```
## 4. 設定のインポート/エクスポート機能

設定を外部ファイルに保存・読み込みする機能の実装例です。

```vb
Imports System.IO
Imports System.Xml.Serialization

Public Class SettingsFormWithExport
    Inherits Form
    
    Private _control As CustomControl
    Private btnExport As Button
    Private btnImport As Button
    
    Private Sub InitializeComponents()
        ' ... 基本的なコントロールの初期化 ...
        
        ' エクスポートボタン
        btnExport = New Button()
        btnExport.Text = "設定をエクスポート..."
        btnExport.Location = New Point(20, 330)
        btnExport.Size = New Size(150, 23)
        AddHandler btnExport.Click, AddressOf BtnExport_Click
        Me.Controls.Add(btnExport)
        
        ' インポートボタン
        btnImport = New Button()
        btnImport.Text = "設定をインポート..."
        btnImport.Location = New Point(180, 330)
        btnImport.Size = New Size(150, 23)
        AddHandler btnImport.Click, AddressOf BtnImport_Click
        Me.Controls.Add(btnImport)
    End Sub
    
    Private Sub BtnExport_Click(sender As Object, e As EventArgs)
        Using sfd As New SaveFileDialog()
            sfd.Filter = "XML ファイル (*.xml)|*.xml|すべてのファイル (*.*)|*.*"
            sfd.DefaultExt = "xml"
            
            If sfd.ShowDialog() = DialogResult.OK Then
                Try
                    ' 設定をシリアル化
                    Dim settings As New ControlSettings With {
                        .ControlName = txtName.Text,
                        .Timeout = CInt(numTimeout.Value),
                        .ConnectionString = txtConnectionString.Text
                    }
                    
                    Dim serializer As New XmlSerializer(GetType(ControlSettings))
                    Using writer As New StreamWriter(sfd.FileName)
                        serializer.Serialize(writer, settings)
                    End Using
                    
                    MessageBox.Show("設定をエクスポートしました", "成功", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Catch ex As Exception
                    MessageBox.Show($"エクスポートに失敗しました: {ex.Message}", "エラー", MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End Using
    End Sub
    
    Private Sub BtnImport_Click(sender As Object, e As EventArgs)
        Using ofd As New OpenFileDialog()
            ofd.Filter = "XML ファイル (*.xml)|*.xml|すべてのファイル (*.*)|*.*"
            
            If ofd.ShowDialog() = DialogResult.OK Then
                Try
                    ' 設定をデシリアル化
                    Dim serializer As New XmlSerializer(GetType(ControlSettings))
                    Using reader As New StreamReader(ofd.FileName)
                        Dim settings = CType(serializer.Deserialize(reader), ControlSettings)
                        
                        ' UIに設定を反映
                        txtName.Text = settings.ControlName
                        numTimeout.Value = settings.Timeout
                        txtConnectionString.Text = settings.ConnectionString
                    End Using
                    
                    MessageBox.Show("設定をインポートしました", "成功", MessageBoxButtons.OK, MessageBoxIcon.Information)
                Catch ex As Exception
                    MessageBox.Show($"インポートに失敗しました: {ex.Message}", "エラー", MessageBoxButtons.OK, MessageBoxIcon.Error)
                End Try
            End If
        End Using
    End Sub
End Class

' 設定を保持するクラス
<Serializable>
Public Class ControlSettings
    Public Property ControlName As String
    Public Property Timeout As Integer
    Public Property ConnectionString As String
End Class
```

## 5. 重要なポイント

### 5-1. デザイナーへの変更通知

```vb
' ❌ 悪い例：直接プロパティに代入
_control.SettingValue = "新しい値"

' ✅ 良い例：TypeDescriptorを使用
Dim properties = TypeDescriptor.GetProperties(_control)
properties("SettingValue").SetValue(_control, "新しい値")
```

`TypeDescriptor`を使うことで：
- Undo/Redo機能が正しく動作
- デザイナーが変更を検知
- プロパティグリッドが更新される

### 5-2. フォームの適切な設定

```vb
' モーダルダイアログとして表示
Me.FormBorderStyle = FormBorderStyle.FixedDialog
Me.MaximizeBox = False
Me.MinimizeBox = False
Me.StartPosition = FormStartPosition.CenterParent

' Enter/Escキーの設定
Me.AcceptButton = btnOK
Me.CancelButton = btnCancel
```

### 5-3. リソースの解放

```vb
' Usingステートメントの使用
Using settingsForm As New SettingsForm(_button)
    If settingsForm.ShowDialog() = DialogResult.OK Then
        ' 処理
    End If
End Using ' 自動的にDispose()が呼ばれる
```

## 6. トラブルシューティング

### 問題1: スマートタグが表示されない

**原因**:
- `Designer`属性が設定されていない
- デザイナークラスの名前空間が正しくない

**解決方法**:
```vb
' コントロールクラスに属性を追加
<Designer(GetType(CustomButtonDesigner))>
Public Class CustomButton
    Inherits Button
End Class
```

### 問題2: 設定が保存されない

**原因**:
- `TypeDescriptor`を使っていない
- プロパティに変更が通知されていない

**解決方法**:
```vb
' TypeDescriptorを使用して変更を通知
Dim properties = TypeDescriptor.GetProperties(_control)
properties("PropertyName").SetValue(_control, newValue)
```

### 問題3: Undo/Redoが動作しない

**原因**:
- `TypeDescriptor.GetProperties`を使わずに直接プロパティを変更している

**解決方法**:
- 必ず`TypeDescriptor`経由でプロパティを設定する

## 7. まとめ

デザイナーのアクションリストから設定フォームを表示することで：

### メリット
- ✅ 複雑な設定をユーザーフレンドリーに提供できる
- ✅ プロパティグリッドだけでは難しい入力をサポート
- ✅ バリデーションやプレビュー機能を実装できる
- ✅ 設定のインポート/エクスポートが可能

### 実装のポイント
1. `DesignerActionList`で設定メニューを定義
2. `DesignerActionMethodItem`でメソッドをメニューに追加
3. `TypeDescriptor`を使って変更を正しく通知
4. `ShowDialog()`でモーダルダイアログとして表示
5. `AcceptButton`/`CancelButton`でキーボード対応

この仕組みを使うことで、プロフェッショナルなカスタムコントロールを作成できます。

## おわりに

本記事では、デザイナーのアクションリスト（スマートタグ）から設定フォームを表示する方法を解説しました。

この技術は、.NET Frameworkの標準コントロール（例：DataGridViewやTabControl）でも使われている手法です。カスタムコントロールの使い勝手を大きく向上させることができるので、ぜひ活用してください。
