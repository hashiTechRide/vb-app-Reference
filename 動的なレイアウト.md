# å‹•çš„ãƒ•ã‚©ãƒ¼ãƒ ç”Ÿæˆã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

## ğŸ“‹ ç›®æ¬¡

- [æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ](#æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ)
- [å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³](#å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³)
- [å®Œå…¨å®Ÿè£…ä¾‹](#å®Œå…¨å®Ÿè£…ä¾‹)
- [é«˜åº¦ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯](#é«˜åº¦ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯)

---

## æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

### ğŸ¯ æœ€é©è§£: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿é§†å‹• + TableLayoutPanel

**ãƒ¡ãƒªãƒƒãƒˆ:**
- ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ä¸è¦ã§ä½ç½®èª¿æ•´ãŒè‡ªå‹•
- å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆJSON/XML/ã‚³ãƒ¼ãƒ‰ï¼‰ã§ç®¡ç†
- ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã‚‚ç°¡å˜
- ä¿å®ˆæ€§ãŒé«˜ã„

---

## å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: TableLayoutPanelä½¿ç”¨ï¼ˆæ¨å¥¨â­â­â­â­â­ï¼‰

```vb
' ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å®šç¾©
Public Class FormFieldDefinition
    Public Property GroupName As String          ' ã‚°ãƒ«ãƒ¼ãƒ—å
    Public Property FieldName As String          ' ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å
    Public Property LabelText As String          ' ãƒ©ãƒ™ãƒ«è¡¨ç¤º
    Public Property ControlType As FieldType     ' ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ç¨®åˆ¥
    Public Property Required As Boolean          ' å¿…é ˆ
    Public Property MaxLength As Integer         ' æœ€å¤§é•·
    Public Property Items As List(Of String)     ' ã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ã®é¸æŠè‚¢
    Public Property DefaultValue As String       ' ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
    Public Property Width As Integer             ' å¹…ï¼ˆçœç•¥å¯ï¼‰
End Class

Public Enum FieldType
    TextBox
    ComboBox
    DatePicker
    NumericUpDown
    CheckBox
    MultiLineTextBox
End Enum
```

### åŸºæœ¬çš„ãªå®Ÿè£…

```vb
Imports TraceSystem.Shared.Controls.Base

Public Class DynamicFormControl
    Inherits BaseUserControl
    
    Private _fieldControls As New Dictionary(Of String, Control)
    Private _fieldDefinitions As List(Of FormFieldDefinition)
    
    ''' <summary>
    ''' ãƒ•ã‚©ãƒ¼ãƒ å®šç¾©ã‹ã‚‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’å‹•çš„ç”Ÿæˆ
    ''' </summary>
    Public Sub BuildForm(definitions As List(Of FormFieldDefinition))
        _fieldDefinitions = definitions
        
        ' ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«åˆ†é¡
        Dim groups = definitions.GroupBy(Function(d) d.GroupName).ToList()
        
        ' ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
        Dim mainLayout As New TableLayoutPanel With {
            .Dock = DockStyle.Fill,
            .AutoScroll = True,
            .ColumnCount = 1,
            .RowCount = groups.Count,
            .Padding = New Padding(10)
        }
        
        Dim rowIndex As Integer = 0
        
        For Each group In groups
            ' ã‚°ãƒ«ãƒ¼ãƒ—ãƒ‘ãƒãƒ«ä½œæˆ
            Dim groupPanel = CreateGroupPanel(group.Key, group.ToList())
            
            mainLayout.Controls.Add(groupPanel, 0, rowIndex)
            mainLayout.RowStyles.Add(New RowStyle(SizeType.AutoSize))
            
            rowIndex += 1
        Next
        
        Me.Controls.Add(mainLayout)
    End Sub
    
    ''' <summary>
    ''' ã‚°ãƒ«ãƒ¼ãƒ—ãƒ‘ãƒãƒ«ä½œæˆ
    ''' </summary>
    Private Function CreateGroupPanel(groupName As String, 
                                     fields As List(Of FormFieldDefinition)) As Panel
        
        ' ã‚°ãƒ«ãƒ¼ãƒ—ãƒœãƒƒã‚¯ã‚¹
        Dim groupBox As New GroupBox With {
            .Text = groupName,
            .Dock = DockStyle.Fill,
            .Padding = New Padding(10),
            .AutoSize = True
        }
        
        ' TableLayoutPanelï¼ˆ2åˆ—: ãƒ©ãƒ™ãƒ« | ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼‰
        Dim table As New TableLayoutPanel With {
            .Dock = DockStyle.Fill,
            .ColumnCount = 2,
            .RowCount = fields.Count,
            .AutoSize = True,
            .Padding = New Padding(5)
        }
        
        ' åˆ—å¹…è¨­å®š
        table.ColumnStyles.Add(New ColumnStyle(SizeType.Absolute, 150)) ' ãƒ©ãƒ™ãƒ«åˆ—
        table.ColumnStyles.Add(New ColumnStyle(SizeType.Percent, 100))  ' ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«åˆ—
        
        ' å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
        For i As Integer = 0 To fields.Count - 1
            Dim field = fields(i)
            
            ' ãƒ©ãƒ™ãƒ«ä½œæˆ
            Dim label = CreateLabel(field)
            table.Controls.Add(label, 0, i)
            
            ' ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ä½œæˆ
            Dim control = CreateControl(field)
            table.Controls.Add(control, 1, i)
            
            ' ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’è¾æ›¸ã«ä¿å­˜ï¼ˆå¾Œã§å€¤ã‚’å–å¾—ã™ã‚‹ãŸã‚ï¼‰
            _fieldControls(field.FieldName) = control
            
            ' è¡Œã‚¹ã‚¿ã‚¤ãƒ«
            table.RowStyles.Add(New RowStyle(SizeType.AutoSize))
        Next
        
        groupBox.Controls.Add(table)
        Return groupBox
    End Function
    
    ''' <summary>
    ''' ãƒ©ãƒ™ãƒ«ä½œæˆ
    ''' </summary>
    Private Function CreateLabel(field As FormFieldDefinition) As Label
        Dim label As New Label With {
            .Text = field.LabelText & If(field.Required, " *", ""),
            .AutoSize = True,
            .Anchor = AnchorStyles.Left,
            .Margin = New Padding(3, 8, 3, 3),
            .Font = New Font("ãƒ¡ã‚¤ãƒªã‚ª", 9)
        }
        
        ' å¿…é ˆé …ç›®ã¯èµ¤è‰²
        If field.Required Then
            label.ForeColor = Color.Red
        End If
        
        Return label
    End Function
    
    ''' <summary>
    ''' ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ä½œæˆ
    ''' </summary>
    Private Function CreateControl(field As FormFieldDefinition) As Control
        Dim control As Control
        
        Select Case field.ControlType
            Case FieldType.TextBox
                control = CreateTextBox(field)
                
            Case FieldType.ComboBox
                control = CreateComboBox(field)
                
            Case FieldType.DatePicker
                control = CreateDatePicker(field)
                
            Case FieldType.NumericUpDown
                control = CreateNumericUpDown(field)
                
            Case FieldType.CheckBox
                control = CreateCheckBox(field)
                
            Case FieldType.MultiLineTextBox
                control = CreateMultiLineTextBox(field)
                
            Case Else
                control = New TextBox()
        End Select
        
        control.Anchor = AnchorStyles.Left Or AnchorStyles.Right
        control.Margin = New Padding(3, 3, 3, 8)
        
        Return control
    End Function
    
    Private Function CreateTextBox(field As FormFieldDefinition) As TextBox
        Dim txt As New TextBox With {
            .MaxLength = If(field.MaxLength > 0, field.MaxLength, 100),
            .Text = field.DefaultValue,
            .Width = If(field.Width > 0, field.Width, 300)
        }
        Return txt
    End Function
    
    Private Function CreateComboBox(field As FormFieldDefinition) As ComboBox
        Dim cmb As New ComboBox With {
            .DropDownStyle = ComboBoxStyle.DropDownList,
            .Width = If(field.Width > 0, field.Width, 300)
        }
        
        If field.Items IsNot Nothing Then
            cmb.Items.AddRange(field.Items.ToArray())
            If Not String.IsNullOrEmpty(field.DefaultValue) Then
                cmb.SelectedItem = field.DefaultValue
            End If
        End If
        
        Return cmb
    End Function
    
    Private Function CreateDatePicker(field As FormFieldDefinition) As DateTimePicker
        Dim dtp As New DateTimePicker With {
            .Format = DateTimePickerFormat.Short,
            .Width = If(field.Width > 0, field.Width, 200)
        }
        Return dtp
    End Function
    
    Private Function CreateNumericUpDown(field As FormFieldDefinition) As NumericUpDown
        Dim nud As New NumericUpDown With {
            .Maximum = 999999,
            .Minimum = 0,
            .Width = If(field.Width > 0, field.Width, 150)
        }
        
        If Not String.IsNullOrEmpty(field.DefaultValue) AndAlso 
           IsNumeric(field.DefaultValue) Then
            nud.Value = CDec(field.DefaultValue)
        End If
        
        Return nud
    End Function
    
    Private Function CreateCheckBox(field As FormFieldDefinition) As CheckBox
        Dim chk As New CheckBox With {
            .Text = "",
            .Checked = If(field.DefaultValue = "True", True, False)
        }
        Return chk
    End Function
    
    Private Function CreateMultiLineTextBox(field As FormFieldDefinition) As TextBox
        Dim txt As New TextBox With {
            .Multiline = True,
            .MaxLength = If(field.MaxLength > 0, field.MaxLength, 1000),
            .Height = 80,
            .ScrollBars = ScrollBars.Vertical,
            .Text = field.DefaultValue,
            .Width = If(field.Width > 0, field.Width, 300)
        }
        Return txt
    End Function
    
    ''' <summary>
    ''' ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’å–å¾—
    ''' </summary>
    Public Function GetFieldValue(fieldName As String) As Object
        If Not _fieldControls.ContainsKey(fieldName) Then
            Return Nothing
        End If
        
        Dim control = _fieldControls(fieldName)
        
        Select Case True
            Case TypeOf control Is TextBox
                Return DirectCast(control, TextBox).Text
                
            Case TypeOf control Is ComboBox
                Return DirectCast(control, ComboBox).SelectedItem
                
            Case TypeOf control Is DateTimePicker
                Return DirectCast(control, DateTimePicker).Value
                
            Case TypeOf control Is NumericUpDown
                Return DirectCast(control, NumericUpDown).Value
                
            Case TypeOf control Is CheckBox
                Return DirectCast(control, CheckBox).Checked
                
            Case Else
                Return Nothing
        End Select
    End Function
    
    ''' <summary>
    ''' ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å€¤ã‚’å–å¾—
    ''' </summary>
    Public Function GetAllValues() As Dictionary(Of String, Object)
        Dim values As New Dictionary(Of String, Object)
        
        For Each kvp In _fieldControls
            values(kvp.Key) = GetFieldValue(kvp.Key)
        Next
        
        Return values
    End Function
    
    ''' <summary>
    ''' ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’è¨­å®š
    ''' </summary>
    Public Sub SetFieldValue(fieldName As String, value As Object)
        If Not _fieldControls.ContainsKey(fieldName) Then
            Return
        End If
        
        Dim control = _fieldControls(fieldName)
        
        Select Case True
            Case TypeOf control Is TextBox
                DirectCast(control, TextBox).Text = value?.ToString()
                
            Case TypeOf control Is ComboBox
                DirectCast(control, ComboBox).SelectedItem = value
                
            Case TypeOf control Is DateTimePicker
                If TypeOf value Is DateTime Then
                    DirectCast(control, DateTimePicker).Value = CDate(value)
                End If
                
            Case TypeOf control Is NumericUpDown
                If IsNumeric(value) Then
                    DirectCast(control, NumericUpDown).Value = CDec(value)
                End If
                
            Case TypeOf control Is CheckBox
                If TypeOf value Is Boolean Then
                    DirectCast(control, CheckBox).Checked = CBool(value)
                End If
        End Select
    End Sub
    
End Class
```

---

## å®Œå…¨å®Ÿè£…ä¾‹

### ä½¿ç”¨ä¾‹1: ãƒˆãƒ¬ãƒ¼ã‚¹è©³ç´°ç”»é¢

```vb
Public Class TraceDetailControl
    Inherits BaseUserControl
    
    Private _dynamicForm As DynamicFormControl
    
    Private Sub TraceDetailControl_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        InitializeDynamicForm()
    End Sub
    
    Private Sub InitializeDynamicForm()
        ' ãƒ•ã‚©ãƒ¼ãƒ å®šç¾©
        Dim definitions As New List(Of FormFieldDefinition) From {
            ' åŸºæœ¬æƒ…å ±ã‚°ãƒ«ãƒ¼ãƒ—
            New FormFieldDefinition With {
                .GroupName = "åŸºæœ¬æƒ…å ±",
                .FieldName = "Title",
                .LabelText = "ã‚¿ã‚¤ãƒˆãƒ«",
                .ControlType = FieldType.TextBox,
                .Required = True,
                .MaxLength = 100
            },
            New FormFieldDefinition With {
                .GroupName = "åŸºæœ¬æƒ…å ±",
                .FieldName = "RequestDate",
                .LabelText = "ç”³è«‹æ—¥",
                .ControlType = FieldType.DatePicker,
                .Required = True
            },
            New FormFieldDefinition With {
                .GroupName = "åŸºæœ¬æƒ…å ±",
                .FieldName = "Status",
                .LabelText = "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹",
                .ControlType = FieldType.ComboBox,
                .Required = True,
                .Items = New List(Of String) From {"ç”³è«‹ä¸­", "æ‰¿èªæ¸ˆã¿", "å´ä¸‹"}
            },
            New FormFieldDefinition With {
                .GroupName = "åŸºæœ¬æƒ…å ±",
                .FieldName = "Priority",
                .LabelText = "å„ªå…ˆåº¦",
                .ControlType = FieldType.ComboBox,
                .Items = New List(Of String) From {"ä½", "ä¸­", "é«˜", "ç·Šæ€¥"}
            },
            
            ' ç”³è«‹è€…æƒ…å ±ã‚°ãƒ«ãƒ¼ãƒ—
            New FormFieldDefinition With {
                .GroupName = "ç”³è«‹è€…æƒ…å ±",
                .FieldName = "RequesterName",
                .LabelText = "ç”³è«‹è€…å",
                .ControlType = FieldType.TextBox,
                .Required = True
            },
            New FormFieldDefinition With {
                .GroupName = "ç”³è«‹è€…æƒ…å ±",
                .FieldName = "RequesterDepartment",
                .LabelText = "æ‰€å±éƒ¨ç½²",
                .ControlType = FieldType.TextBox
            },
            New FormFieldDefinition With {
                .GroupName = "ç”³è«‹è€…æƒ…å ±",
                .FieldName = "RequesterEmail",
                .LabelText = "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹",
                .ControlType = FieldType.TextBox
            },
            
            ' å¤‰æ›´å†…å®¹ã‚°ãƒ«ãƒ¼ãƒ—
            New FormFieldDefinition With {
                .GroupName = "å¤‰æ›´å†…å®¹",
                .FieldName = "ChangeType",
                .LabelText = "å¤‰æ›´ç¨®åˆ¥",
                .ControlType = FieldType.ComboBox,
                .Items = New List(Of String) From {"æ–°è¦", "ä¿®æ­£", "å‰Šé™¤"}
            },
            New FormFieldDefinition With {
                .GroupName = "å¤‰æ›´å†…å®¹",
                .FieldName = "TargetSystem",
                .LabelText = "å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ ",
                .ControlType = FieldType.TextBox
            },
            New FormFieldDefinition With {
                .GroupName = "å¤‰æ›´å†…å®¹",
                .FieldName = "Description",
                .LabelText = "å¤‰æ›´å†…å®¹",
                .ControlType = FieldType.MultiLineTextBox,
                .Required = True
            },
            New FormFieldDefinition With {
                .GroupName = "å¤‰æ›´å†…å®¹",
                .FieldName = "Reason",
                .LabelText = "å¤‰æ›´ç†ç”±",
                .ControlType = FieldType.MultiLineTextBox,
                .Required = True
            },
            
            ' ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—
            New FormFieldDefinition With {
                .GroupName = "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«",
                .FieldName = "ScheduledStartDate",
                .LabelText = "é–‹å§‹äºˆå®šæ—¥",
                .ControlType = FieldType.DatePicker
            },
            New FormFieldDefinition With {
                .GroupName = "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«",
                .FieldName = "ScheduledEndDate",
                .LabelText = "å®Œäº†äºˆå®šæ—¥",
                .ControlType = FieldType.DatePicker
            },
            New FormFieldDefinition With {
                .GroupName = "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«",
                .FieldName = "EstimatedHours",
                .LabelText = "è¦‹ç©æ™‚é–“ï¼ˆæ™‚é–“ï¼‰",
                .ControlType = FieldType.NumericUpDown
            },
            
            ' æ‰¿èªæƒ…å ±ã‚°ãƒ«ãƒ¼ãƒ—
            New FormFieldDefinition With {
                .GroupName = "æ‰¿èªæƒ…å ±",
                .FieldName = "ApproverName",
                .LabelText = "æ‰¿èªè€…",
                .ControlType = FieldType.TextBox
            },
            New FormFieldDefinition With {
                .GroupName = "æ‰¿èªæƒ…å ±",
                .FieldName = "ApprovedDate",
                .LabelText = "æ‰¿èªæ—¥",
                .ControlType = FieldType.DatePicker
            },
            New FormFieldDefinition With {
                .GroupName = "æ‰¿èªæƒ…å ±",
                .FieldName = "ApprovalComment",
                .LabelText = "æ‰¿èªã‚³ãƒ¡ãƒ³ãƒˆ",
                .ControlType = FieldType.MultiLineTextBox
            },
            
            ' ãã®ä»–ã‚°ãƒ«ãƒ¼ãƒ—
            New FormFieldDefinition With {
                .GroupName = "ãã®ä»–",
                .FieldName = "IsUrgent",
                .LabelText = "ç·Šæ€¥å¯¾å¿œ",
                .ControlType = FieldType.CheckBox
            },
            New FormFieldDefinition With {
                .GroupName = "ãã®ä»–",
                .FieldName = "RequiresDowntime",
                .LabelText = "ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ å¿…è¦",
                .ControlType = FieldType.CheckBox
            },
            New FormFieldDefinition With {
                .GroupName = "ãã®ä»–",
                .FieldName = "Notes",
                .LabelText = "å‚™è€ƒ",
                .ControlType = FieldType.MultiLineTextBox
            }
        }
        
        ' å‹•çš„ãƒ•ã‚©ãƒ¼ãƒ ç”Ÿæˆ
        _dynamicForm = New DynamicFormControl()
        _dynamicForm.Dock = DockStyle.Fill
        _dynamicForm.BuildForm(definitions)
        
        Me.Controls.Add(_dynamicForm)
    End Sub
    
    ''' <summary>
    ''' ãƒ‡ãƒ¼ã‚¿ä¿å­˜
    ''' </summary>
    Private Sub btnSave_Click(sender As Object, e As EventArgs) Handles btnSave.Click
        ' ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å€¤ã‚’å–å¾—
        Dim values = _dynamicForm.GetAllValues()
        
        ' DTOã«è©°ã‚ã‚‹
        Dim dto As New TraceDto With {
            .Title = values("Title")?.ToString(),
            .RequestDate = CDate(values("RequestDate")),
            .Status = values("Status")?.ToString(),
            .RequesterName = values("RequesterName")?.ToString(),
            .Description = values("Description")?.ToString()
            ' ...ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
        }
        
        ' ã‚µãƒ¼ãƒ“ã‚¹ã«æ¸¡ã—ã¦ä¿å­˜
        Dim service = ServiceContainer.Instance.Resolve(Of ITraceService)()
        Dim result = service.SaveTrace(dto)
        
        If result.Success Then
            MessageBox.Show("ä¿å­˜ã—ã¾ã—ãŸ")
        Else
            MessageBox.Show($"ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: {result.Message}")
        End If
    End Sub
    
    ''' <summary>
    ''' ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    ''' </summary>
    Public Sub LoadTrace(traceId As Integer)
        Dim service = ServiceContainer.Instance.Resolve(Of ITraceService)()
        Dim trace = service.GetTrace(traceId)
        
        ' ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å€¤ã‚’è¨­å®š
        _dynamicForm.SetFieldValue("Title", trace.Title)
        _dynamicForm.SetFieldValue("RequestDate", trace.RequestDate)
        _dynamicForm.SetFieldValue("Status", trace.Status)
        _dynamicForm.SetFieldValue("RequesterName", trace.RequesterName)
        _dynamicForm.SetFieldValue("Description", trace.Description)
        ' ...ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    End Sub
    
End Class
```

---

## é«˜åº¦ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: JSONå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ä½¿ç”¨

#### fields.json

```json
{
  "groups": [
    {
      "name": "åŸºæœ¬æƒ…å ±",
      "fields": [
        {
          "fieldName": "Title",
          "labelText": "ã‚¿ã‚¤ãƒˆãƒ«",
          "controlType": "TextBox",
          "required": true,
          "maxLength": 100
        },
        {
          "fieldName": "RequestDate",
          "labelText": "ç”³è«‹æ—¥",
          "controlType": "DatePicker",
          "required": true
        },
        {
          "fieldName": "Status",
          "labelText": "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹",
          "controlType": "ComboBox",
          "required": true,
          "items": ["ç”³è«‹ä¸­", "æ‰¿èªæ¸ˆã¿", "å´ä¸‹"]
        }
      ]
    },
    {
      "name": "ç”³è«‹è€…æƒ…å ±",
      "fields": [
        {
          "fieldName": "RequesterName",
          "labelText": "ç”³è«‹è€…å",
          "controlType": "TextBox",
          "required": true
        }
      ]
    }
  ]
}
```

#### JSONã‹ã‚‰èª­ã¿è¾¼ã¿

```vb
Imports Newtonsoft.Json

Public Class FormDefinitionLoader
    
    Public Shared Function LoadFromJson(filePath As String) As List(Of FormFieldDefinition)
        Dim json = File.ReadAllText(filePath)
        Dim config = JsonConvert.DeserializeObject(Of FormConfiguration)(json)
        
        Dim definitions As New List(Of FormFieldDefinition)
        
        For Each group In config.Groups
            For Each field In group.Fields
                field.GroupName = group.Name
                definitions.Add(field)
            Next
        Next
        
        Return definitions
    End Function
    
End Class

Public Class FormConfiguration
    Public Property Groups As List(Of FormGroup)
End Class

Public Class FormGroup
    Public Property Name As String
    Public Property Fields As List(Of FormFieldDefinition)
End Class

' ä½¿ç”¨ä¾‹
Private Sub InitializeDynamicForm()
    Dim definitions = FormDefinitionLoader.LoadFromJson("fields.json")
    _dynamicForm.BuildForm(definitions)
End Sub
```

---

### ãƒ‘ã‚¿ãƒ¼ãƒ³3: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ä»˜ã

```vb
Public Class DynamicFormControl
    
    ' ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½è¿½åŠ 
    Public Function Validate() As ValidationResult
        Dim errors As New List(Of String)
        
        For Each field In _fieldDefinitions
            ' å¿…é ˆãƒã‚§ãƒƒã‚¯
            If field.Required Then
                Dim value = GetFieldValue(field.FieldName)
                
                If value Is Nothing OrElse String.IsNullOrWhiteSpace(value.ToString()) Then
                    errors.Add($"{field.LabelText}ã¯å¿…é ˆã§ã™")
                End If
            End If
            
            ' ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            If field.Validator IsNot Nothing Then
                Dim validationResult = field.Validator(GetFieldValue(field.FieldName))
                If Not validationResult.IsValid Then
                    errors.AddRange(validationResult.Errors)
                End If
            End If
        Next
        
        Return New ValidationResult With {
            .IsValid = errors.Count = 0,
            .Errors = errors
        }
    End Function
    
End Class

' ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©ã«ãƒãƒªãƒ‡ãƒ¼ã‚¿è¿½åŠ 
Public Class FormFieldDefinition
    ' ...æ—¢å­˜ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
    
    Public Property Validator As Func(Of Object, ValidationResult)
End Class

' ä½¿ç”¨ä¾‹
New FormFieldDefinition With {
    .FieldName = "Email",
    .LabelText = "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹",
    .ControlType = FieldType.TextBox,
    .Validator = Function(value)
        Dim email = value?.ToString()
        If Not String.IsNullOrEmpty(email) AndAlso 
           Not Regex.IsMatch(email, "^[\w\.-]+@[\w\.-]+\.\w+$") Then
            Return New ValidationResult With {
                .IsValid = False,
                .Errors = New List(Of String) From {"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“"}
            }
        End If
        Return New ValidationResult With {.IsValid = True}
    End Function
}
```

---

### ãƒ‘ã‚¿ãƒ¼ãƒ³4: æ¡ä»¶ä»˜ãè¡¨ç¤º

```vb
Public Class FormFieldDefinition
    ' ...æ—¢å­˜ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
    
    ''' <summary>
    ''' è¡¨ç¤ºæ¡ä»¶ï¼ˆä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã«å¿œã˜ã¦è¡¨ç¤º/éè¡¨ç¤ºï¼‰
    ''' </summary>
    Public Property VisibilityCondition As Func(Of Dictionary(Of String, Object), Boolean)
End Class

Public Class DynamicFormControl
    
    ''' <summary>
    ''' è¡¨ç¤ºæ¡ä»¶ã«åŸºã¥ã„ã¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®å¯è¦–æ€§ã‚’æ›´æ–°
    ''' </summary>
    Public Sub UpdateVisibility()
        Dim allValues = GetAllValues()
        
        For Each field In _fieldDefinitions
            If field.VisibilityCondition IsNot Nothing Then
                Dim shouldVisible = field.VisibilityCondition(allValues)
                
                If _fieldControls.ContainsKey(field.FieldName) Then
                    _fieldControls(field.FieldName).Visible = shouldVisible
                    ' ãƒ©ãƒ™ãƒ«ã‚‚åŒæ™‚ã«è¡¨ç¤º/éè¡¨ç¤ºï¼ˆå®Ÿè£…ãŒå¿…è¦ï¼‰
                End If
            End If
        Next
    End Sub
    
End Class

' ä½¿ç”¨ä¾‹
Dim definitions As New List(Of FormFieldDefinition) From {
    New FormFieldDefinition With {
        .FieldName = "ChangeType",
        .LabelText = "å¤‰æ›´ç¨®åˆ¥",
        .ControlType = FieldType.ComboBox,
        .Items = New List(Of String) From {"æ–°è¦", "ä¿®æ­£", "å‰Šé™¤"}
    },
    New FormFieldDefinition With {
        .FieldName = "DeleteReason",
        .LabelText = "å‰Šé™¤ç†ç”±",
        .ControlType = FieldType.MultiLineTextBox,
        .Required = True,
        ' å¤‰æ›´ç¨®åˆ¥ãŒã€Œå‰Šé™¤ã€ã®å ´åˆã®ã¿è¡¨ç¤º
        .VisibilityCondition = Function(values)
            Return values.ContainsKey("ChangeType") AndAlso 
                   values("ChangeType")?.ToString() = "å‰Šé™¤"
        End Function
    }
}

' ã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ã®å€¤å¤‰æ›´æ™‚ã«è¡¨ç¤ºã‚’æ›´æ–°
AddHandler someComboBox.SelectedIndexChanged, 
    Sub(s, e) _dynamicForm.UpdateVisibility()
```

---

### ãƒ‘ã‚¿ãƒ¼ãƒ³5: FlowLayoutPanelä½¿ç”¨ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼‰

```vb
''' <summary>
''' ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆç”»é¢ã‚µã‚¤ã‚ºã«å¿œã˜ã¦æŠ˜ã‚Šè¿”ã—ï¼‰
''' </summary>
Private Function CreateFlexibleLayout(fields As List(Of FormFieldDefinition)) As FlowLayoutPanel
    Dim flow As New FlowLayoutPanel With {
        .Dock = DockStyle.Fill,
        .FlowDirection = FlowDirection.TopDown,
        .WrapContents = False,
        .AutoScroll = True,
        .Padding = New Padding(10)
    }
    
    For Each field In fields
        ' ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠ
        Dim container As New Panel With {
            .Width = flow.Width - 30,
            .Height = 35,
            .Margin = New Padding(0, 0, 0, 5)
        }
        
        ' ãƒ©ãƒ™ãƒ«
        Dim label = CreateLabel(field)
        label.Location = New Point(0, 8)
        label.Width = 150
        container.Controls.Add(label)
        
        ' ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
        Dim control = CreateControl(field)
        control.Location = New Point(160, 5)
        control.Width = container.Width - 170
        container.Controls.Add(control)
        
        flow.Controls.Add(container)
        _fieldControls(field.FieldName) = control
    Next
    
    Return flow
End Function
```

---

## ğŸ“Š ãƒ‘ã‚¿ãƒ¼ãƒ³æ¯”è¼ƒ

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | é›£æ˜“åº¦ | æŸ”è»Ÿæ€§ | ä¿å®ˆæ€§ | æ¨å¥¨åº¦ |
|---------|--------|--------|--------|--------|
| **TableLayoutPanel** | â­â­â˜†â˜†â˜† | â­â­â­â­â­ | â­â­â­â­â­ | **â­â­â­â­â­** |
| **JSONå®šç¾©** | â­â­â­â˜†â˜† | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â˜† |
| **FlowLayoutPanel** | â­â­â˜†â˜†â˜† | â­â­â­â˜†â˜† | â­â­â­â­â˜† | â­â­â­â˜†â˜† |
| **æ‰‹å‹•é…ç½®** | â­â˜†â˜†â˜†â˜† | â­â˜†â˜†â˜†â˜† | â­â˜†â˜†â˜†â˜† | â­â˜†â˜†â˜†â˜† |

---

## âœ… ã¾ã¨ã‚

### æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆã‚ãªãŸã®ã‚±ãƒ¼ã‚¹ï¼‰

**20é …ç›® + ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚° = TableLayoutPanel + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿é§†å‹•**

```vb
' 1. ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©ï¼ˆã‚³ãƒ¼ãƒ‰ã¾ãŸã¯JSONï¼‰
' 2. DynamicFormControl.BuildForm() ã§ä¸€æ‹¬ç”Ÿæˆ
' 3. GetAllValues() / SetFieldValue() ã§å€¤ã®å–å¾—ãƒ»è¨­å®š
```

### ãƒ¡ãƒªãƒƒãƒˆ

âœ… ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ä¸è¦  
âœ… ä½ç½®èª¿æ•´ãŒè‡ªå‹•  
âœ… ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ãŒç°¡å˜  
âœ… é …ç›®è¿½åŠ ãŒå®¹æ˜“ï¼ˆå®šç¾©è¿½åŠ ã®ã¿ï¼‰  
âœ… ä¿å®ˆæ€§ãŒé«˜ã„  
âœ… å†åˆ©ç”¨å¯èƒ½  

ã“ã®å®Ÿè£…ãªã‚‰ã€20é …ç›®ã§ã‚‚100é …ç›®ã§ã‚‚åŒã˜ã‚ˆã†ã«æ‰±ãˆã¾ã™ï¼

# è¤‡é›‘ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«å¯¾å¿œã—ãŸå‹•çš„ãƒ•ã‚©ãƒ¼ãƒ ç”Ÿæˆ

## ğŸ“‹ æ‹¡å¼µç‰ˆã®è¨­è¨ˆ

### æ–°ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—ã®è¿½åŠ 

```vb
Public Enum FieldType
    TextBox
    ComboBox
    DatePicker
    NumericUpDown
    CheckBox
    MultiLineTextBox
    ' æ–°è¦è¿½åŠ  â†“
    BeforeAfterComparison    ' å¤‰æ›´å‰/å¤‰æ›´å¾Œã®æ¯”è¼ƒè¡¨ç¤º
    CustomLayout             ' ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
End Enum

Public Enum ComparisonLayout
    Horizontal               ' æ¨ªä¸¦ã³ï¼ˆå¤‰æ›´å‰ â†’ å¤‰æ›´å¾Œï¼‰
    Vertical                ' ç¸¦ä¸¦ã³
End Enum
```

---

## ğŸ¯ æ‹¡å¼µã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©

```vb
Public Class FormFieldDefinition
    ' æ—¢å­˜ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
    Public Property GroupName As String
    Public Property FieldName As String
    Public Property LabelText As String
    Public Property ControlType As FieldType
    Public Property Required As Boolean
    Public Property MaxLength As Integer
    Public Property Items As List(Of String)
    Public Property DefaultValue As String
    Public Property Width As Integer
    
    ' æ–°è¦è¿½åŠ  â†“
    ''' <summary>
    ''' æ¯”è¼ƒãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç”¨ã®è¨­å®š
    ''' </summary>
    Public Property ComparisonConfig As ComparisonFieldConfig
    
    ''' <summary>
    ''' ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç”¨ã®å­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    ''' </summary>
    Public Property ChildFields As List(Of FormFieldDefinition)
    
    ''' <summary>
    ''' ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆæ¨ªä¸¦ã³/ç¸¦ä¸¦ã³ï¼‰
    ''' </summary>
    Public Property Layout As ComparisonLayout
End Class

''' <summary>
''' æ¯”è¼ƒãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¨­å®š
''' </summary>
Public Class ComparisonFieldConfig
    ''' <summary>
    ''' å¤‰æ›´å‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å
    ''' </summary>
    Public Property BeforeFieldName As String
    
    ''' <summary>
    ''' å¤‰æ›´å¾Œã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å
    ''' </summary>
    Public Property AfterFieldName As String
    
    ''' <summary>
    ''' å¤‰æ›´å‰ã®ãƒ©ãƒ™ãƒ«
    ''' </summary>
    Public Property BeforeLabel As String
    
    ''' <summary>
    ''' å¤‰æ›´å¾Œã®ãƒ©ãƒ™ãƒ«
    ''' </summary>
    Public Property AfterLabel As String
    
    ''' <summary>
    ''' çŸ¢å°ç”»åƒã®ãƒ‘ã‚¹
    ''' </summary>
    Public Property ArrowImagePath As String
    
    ''' <summary>
    ''' å„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®å¹…
    ''' </summary>
    Public Property ControlWidth As Integer
    
    ''' <summary>
    ''' ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—ï¼ˆä¸¡æ–¹åŒã˜å ´åˆï¼‰
    ''' </summary>
    Public Property InnerControlType As FieldType
    
    ''' <summary>
    ''' ã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ã®é¸æŠè‚¢
    ''' </summary>
    Public Property Items As List(Of String)
End Class
```

---

## ğŸ’» æ‹¡å¼µç‰ˆDynamicFormControl

```vb
Public Class DynamicFormControl
    Inherits BaseUserControl
    
    Private _fieldControls As New Dictionary(Of String, Control)
    Private _fieldDefinitions As List(Of FormFieldDefinition)
    
    ' æ—¢å­˜ã®BuildForm()ã¯åŒã˜...
    
    ''' <summary>
    ''' ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ä½œæˆï¼ˆæ‹¡å¼µç‰ˆï¼‰
    ''' </summary>
    Private Function CreateControl(field As FormFieldDefinition) As Control
        Dim control As Control
        
        Select Case field.ControlType
            Case FieldType.TextBox
                control = CreateTextBox(field)
                
            Case FieldType.ComboBox
                control = CreateComboBox(field)
                
            Case FieldType.DatePicker
                control = CreateDatePicker(field)
                
            Case FieldType.NumericUpDown
                control = CreateNumericUpDown(field)
                
            Case FieldType.CheckBox
                control = CreateCheckBox(field)
                
            Case FieldType.MultiLineTextBox
                control = CreateMultiLineTextBox(field)
                
            ' æ–°è¦è¿½åŠ  â†“
            Case FieldType.BeforeAfterComparison
                control = CreateBeforeAfterComparison(field)
                
            Case FieldType.CustomLayout
                control = CreateCustomLayout(field)
                
            Case Else
                control = New TextBox()
        End Select
        
        control.Anchor = AnchorStyles.Left Or AnchorStyles.Right
        control.Margin = New Padding(3, 3, 3, 8)
        
        Return control
    End Function
    
    ''' <summary>
    ''' å¤‰æ›´å‰/å¤‰æ›´å¾Œã®æ¯”è¼ƒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ä½œæˆ
    ''' </summary>
    Private Function CreateBeforeAfterComparison(field As FormFieldDefinition) As Panel
        Dim config = field.ComparisonConfig
        If config Is Nothing Then
            Throw New ArgumentException("ComparisonConfigãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“")
        End If
        
        ' ãƒ¡ã‚¤ãƒ³ãƒ‘ãƒãƒ«
        Dim mainPanel As New Panel With {
            .AutoSize = True,
            .Height = 40
        }
        
        ' TableLayoutPanelï¼ˆ3åˆ—: å¤‰æ›´å‰ | çŸ¢å° | å¤‰æ›´å¾Œï¼‰
        Dim table As New TableLayoutPanel With {
            .Dock = DockStyle.Fill,
            .ColumnCount = 3,
            .RowCount = 2,  ' 1è¡Œç›®:ãƒ©ãƒ™ãƒ«, 2è¡Œç›®:ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
            .AutoSize = True
        }
        
        ' åˆ—å¹…è¨­å®š
        Dim controlWidth = If(config.ControlWidth > 0, config.ControlWidth, 200)
        table.ColumnStyles.Add(New ColumnStyle(SizeType.Absolute, controlWidth))      ' å¤‰æ›´å‰
        table.ColumnStyles.Add(New ColumnStyle(SizeType.Absolute, 50))                 ' çŸ¢å°
        table.ColumnStyles.Add(New ColumnStyle(SizeType.Absolute, controlWidth))      ' å¤‰æ›´å¾Œ
        
        ' è¡Œã‚¹ã‚¿ã‚¤ãƒ«
        table.RowStyles.Add(New RowStyle(SizeType.Absolute, 20))  ' ãƒ©ãƒ™ãƒ«è¡Œ
        table.RowStyles.Add(New RowStyle(SizeType.AutoSize))      ' ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¡Œ
        
        ' === 1è¡Œç›®: ãƒ©ãƒ™ãƒ« ===
        
        ' å¤‰æ›´å‰ãƒ©ãƒ™ãƒ«
        Dim beforeLabel As New Label With {
            .Text = config.BeforeLabel,
            .AutoSize = True,
            .Anchor = AnchorStyles.Left,
            .Font = New Font("ãƒ¡ã‚¤ãƒªã‚ª", 8),
            .ForeColor = Color.Gray
        }
        table.Controls.Add(beforeLabel, 0, 0)
        
        ' å¤‰æ›´å¾Œãƒ©ãƒ™ãƒ«
        Dim afterLabel As New Label With {
            .Text = config.AfterLabel,
            .AutoSize = True,
            .Anchor = AnchorStyles.Left,
            .Font = New Font("ãƒ¡ã‚¤ãƒªã‚ª", 8),
            .ForeColor = Color.Gray
        }
        table.Controls.Add(afterLabel, 2, 0)
        
        ' === 2è¡Œç›®: ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« ===
        
        ' å¤‰æ›´å‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
        Dim beforeControl = CreateInnerControl(config)
        beforeControl.Width = controlWidth - 10
        table.Controls.Add(beforeControl, 0, 1)
        _fieldControls(config.BeforeFieldName) = beforeControl
        
        ' çŸ¢å°ç”»åƒ
        Dim arrowPicture As New PictureBox With {
            .Width = 40,
            .Height = 30,
            .SizeMode = PictureBoxSizeMode.Zoom,
            .Anchor = AnchorStyles.None,
            .Margin = New Padding(5, 5, 5, 5)
        }
        
        ' çŸ¢å°ç”»åƒã®èª­ã¿è¾¼ã¿
        If Not String.IsNullOrEmpty(config.ArrowImagePath) AndAlso 
           File.Exists(config.ArrowImagePath) Then
            arrowPicture.Image = Image.FromFile(config.ArrowImagePath)
        Else
            ' ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçŸ¢å°ã‚’æç”»
            arrowPicture.Image = CreateArrowImage()
        End If
        
        table.Controls.Add(arrowPicture, 1, 1)
        
        ' å¤‰æ›´å¾Œã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
        Dim afterControl = CreateInnerControl(config)
        afterControl.Width = controlWidth - 10
        table.Controls.Add(afterControl, 2, 1)
        _fieldControls(config.AfterFieldName) = afterControl
        
        mainPanel.Controls.Add(table)
        Return mainPanel
    End Function
    
    ''' <summary>
    ''' æ¯”è¼ƒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«å†…éƒ¨ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ä½œæˆ
    ''' </summary>
    Private Function CreateInnerControl(config As ComparisonFieldConfig) As Control
        Dim control As Control
        
        Select Case config.InnerControlType
            Case FieldType.TextBox
                control = New TextBox With {
                    .MaxLength = 100
                }
                
            Case FieldType.ComboBox
                Dim cmb As New ComboBox With {
                    .DropDownStyle = ComboBoxStyle.DropDownList
                }
                If config.Items IsNot Nothing Then
                    cmb.Items.AddRange(config.Items.ToArray())
                End If
                control = cmb
                
            Case FieldType.DatePicker
                control = New DateTimePicker With {
                    .Format = DateTimePickerFormat.Short
                }
                
            Case FieldType.NumericUpDown
                control = New NumericUpDown With {
                    .Maximum = 999999,
                    .Minimum = 0
                }
                
            Case Else
                control = New TextBox()
        End Select
        
        Return control
    End Function
    
    ''' <summary>
    ''' ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçŸ¢å°ç”»åƒã‚’ç”Ÿæˆ
    ''' </summary>
    Private Function CreateArrowImage() As Bitmap
        Dim bmp As New Bitmap(40, 30)
        Using g As Graphics = Graphics.FromImage(bmp)
            g.SmoothingMode = Drawing2D.SmoothingMode.AntiAlias
            g.Clear(Color.Transparent)
            
            ' çŸ¢å°ã‚’æç”»
            Using pen As New Pen(Color.Gray, 2)
                pen.EndCap = Drawing2D.LineCap.ArrowAnchor
                g.DrawLine(pen, 5, 15, 35, 15)
            End Using
        End Using
        
        Return bmp
    End Function
    
    ''' <summary>
    ''' ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä½œæˆï¼ˆè¤‡æ•°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®çµ„ã¿åˆã‚ã›ï¼‰
    ''' </summary>
    Private Function CreateCustomLayout(field As FormFieldDefinition) As Panel
        Dim mainPanel As New Panel With {
            .AutoSize = True,
            .Height = 40
        }
        
        If field.ChildFields Is Nothing OrElse field.ChildFields.Count = 0 Then
            Return mainPanel
        End If
        
        ' FlowLayoutPanelã§å­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ¨ªä¸¦ã³
        Dim flow As New FlowLayoutPanel With {
            .Dock = DockStyle.Fill,
            .FlowDirection = FlowDirection.LeftToRight,
            .AutoSize = True,
            .WrapContents = False
        }
        
        For Each childField In field.ChildFields
            ' å„å­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚³ãƒ³ãƒ†ãƒŠ
            Dim container As New Panel With {
                .AutoSize = True,
                .Margin = New Padding(0, 0, 10, 0)
            }
            
            ' ãƒ©ãƒ™ãƒ«
            If Not String.IsNullOrEmpty(childField.LabelText) Then
                Dim label As New Label With {
                    .Text = childField.LabelText,
                    .AutoSize = True,
                    .Location = New Point(0, 0)
                }
                container.Controls.Add(label)
            End If
            
            ' ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
            Dim control = CreateSimpleControl(childField)
            control.Location = New Point(0, 20)
            container.Controls.Add(control)
            
            _fieldControls(childField.FieldName) = control
            
            flow.Controls.Add(container)
        Next
        
        mainPanel.Controls.Add(flow)
        Return mainPanel
    End Function
    
    ''' <summary>
    ''' ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ä½œæˆï¼ˆå†å¸°ã‚’é¿ã‘ã‚‹ï¼‰
    ''' </summary>
    Private Function CreateSimpleControl(field As FormFieldDefinition) As Control
        Select Case field.ControlType
            Case FieldType.TextBox
                Return CreateTextBox(field)
            Case FieldType.ComboBox
                Return CreateComboBox(field)
            Case FieldType.DatePicker
                Return CreateDatePicker(field)
            Case Else
                Return New TextBox()
        End Select
    End Function
    
    ' æ—¢å­˜ã®GetFieldValue()ã¯å¤‰æ›´ãªã—
    ' æ—¢å­˜ã®SetFieldValue()ã¯å¤‰æ›´ãªã—
    
End Class
```

---

## ğŸ“ ä½¿ç”¨ä¾‹

### ä¾‹1: ãƒˆãƒ¬ãƒ¼ã‚¹å¤‰æ›´ç”»é¢ï¼ˆå“åã®å¤‰æ›´å‰å¾Œï¼‰

```vb
Public Class TraceDetailControl
    Inherits BaseUserControl
    
    Private _dynamicForm As DynamicFormControl
    
    Private Sub InitializeDynamicForm()
        Dim definitions As New List(Of FormFieldDefinition) From {
            ' åŸºæœ¬æƒ…å ±
            New FormFieldDefinition With {
                .GroupName = "åŸºæœ¬æƒ…å ±",
                .FieldName = "TraceId",
                .LabelText = "ãƒˆãƒ¬ãƒ¼ã‚¹ID",
                .ControlType = FieldType.TextBox,
                .Required = True
            },
            
            ' å“åã®å¤‰æ›´ï¼ˆå¤‰æ›´å‰/å¤‰æ›´å¾Œï¼‰
            New FormFieldDefinition With {
                .GroupName = "å¤‰æ›´å†…å®¹",
                .FieldName = "ProductNameComparison",
                .LabelText = "å“å",
                .ControlType = FieldType.BeforeAfterComparison,
                .ComparisonConfig = New ComparisonFieldConfig With {
                    .BeforeFieldName = "ProductNameBefore",
                    .AfterFieldName = "ProductNameAfter",
                    .BeforeLabel = "å¤‰æ›´å‰",
                    .AfterLabel = "å¤‰æ›´å¾Œ",
                    .ArrowImagePath = "Resources\arrow-right.png",  ' çŸ¢å°ç”»åƒ
                    .ControlWidth = 250,
                    .InnerControlType = FieldType.TextBox
                }
            },
            
            ' å˜ä¾¡ã®å¤‰æ›´ï¼ˆå¤‰æ›´å‰/å¤‰æ›´å¾Œï¼‰
            New FormFieldDefinition With {
                .GroupName = "å¤‰æ›´å†…å®¹",
                .FieldName = "UnitPriceComparison",
                .LabelText = "å˜ä¾¡",
                .ControlType = FieldType.BeforeAfterComparison,
                .ComparisonConfig = New ComparisonFieldConfig With {
                    .BeforeFieldName = "UnitPriceBefore",
                    .AfterFieldName = "UnitPriceAfter",
                    .BeforeLabel = "å¤‰æ›´å‰ï¼ˆå††ï¼‰",
                    .AfterLabel = "å¤‰æ›´å¾Œï¼ˆå††ï¼‰",
                    .ArrowImagePath = "Resources\arrow-right.png",
                    .ControlWidth = 150,
                    .InnerControlType = FieldType.NumericUpDown
                }
            },
            
            ' ã‚«ãƒ†ã‚´ãƒªã®å¤‰æ›´ï¼ˆå¤‰æ›´å‰/å¤‰æ›´å¾Œ - ã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ï¼‰
            New FormFieldDefinition With {
                .GroupName = "å¤‰æ›´å†…å®¹",
                .FieldName = "CategoryComparison",
                .LabelText = "ã‚«ãƒ†ã‚´ãƒª",
                .ControlType = FieldType.BeforeAfterComparison,
                .ComparisonConfig = New ComparisonFieldConfig With {
                    .BeforeFieldName = "CategoryBefore",
                    .AfterFieldName = "CategoryAfter",
                    .BeforeLabel = "å¤‰æ›´å‰",
                    .AfterLabel = "å¤‰æ›´å¾Œ",
                    .ArrowImagePath = "Resources\arrow-right.png",
                    .ControlWidth = 200,
                    .InnerControlType = FieldType.ComboBox,
                    .Items = New List(Of String) From {
                        "é£Ÿå“", "é£²æ–™", "æ—¥ç”¨å“", "é›»åŒ–è£½å“", "ãã®ä»–"
                    }
                }
            },
            
            ' é€šå¸¸ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
            New FormFieldDefinition With {
                .GroupName = "å¤‰æ›´å†…å®¹",
                .FieldName = "ChangeReason",
                .LabelText = "å¤‰æ›´ç†ç”±",
                .ControlType = FieldType.MultiLineTextBox,
                .Required = True
            }
        }
        
        _dynamicForm = New DynamicFormControl()
        _dynamicForm.Dock = DockStyle.Fill
        _dynamicForm.BuildForm(definitions)
        
        Me.Controls.Add(_dynamicForm)
    End Sub
    
    ''' <summary>
    ''' ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    ''' </summary>
    Public Sub LoadTrace(traceId As Integer)
        ' ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
        Dim service = ServiceContainer.Instance.Resolve(Of ITraceService)()
        Dim trace = service.GetTrace(traceId)
        
        ' é€šå¸¸ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
        _dynamicForm.SetFieldValue("TraceId", trace.Id.ToString())
        _dynamicForm.SetFieldValue("ChangeReason", trace.ChangeReason)
        
        ' æ¯”è¼ƒãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå¤‰æ›´å‰ï¼‰
        _dynamicForm.SetFieldValue("ProductNameBefore", trace.ProductNameBefore)
        _dynamicForm.SetFieldValue("UnitPriceBefore", trace.UnitPriceBefore)
        _dynamicForm.SetFieldValue("CategoryBefore", trace.CategoryBefore)
        
        ' æ¯”è¼ƒãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå¤‰æ›´å¾Œï¼‰
        _dynamicForm.SetFieldValue("ProductNameAfter", trace.ProductNameAfter)
        _dynamicForm.SetFieldValue("UnitPriceAfter", trace.UnitPriceAfter)
        _dynamicForm.SetFieldValue("CategoryAfter", trace.CategoryAfter)
    End Sub
    
    ''' <summary>
    ''' ãƒ‡ãƒ¼ã‚¿ä¿å­˜
    ''' </summary>
    Private Sub btnSave_Click(sender As Object, e As EventArgs) Handles btnSave.Click
        Dim values = _dynamicForm.GetAllValues()
        
        Dim dto As New TraceDto With {
            .ProductNameBefore = values("ProductNameBefore")?.ToString(),
            .ProductNameAfter = values("ProductNameAfter")?.ToString(),
            .UnitPriceBefore = CDec(values("UnitPriceBefore")),
            .UnitPriceAfter = CDec(values("UnitPriceAfter")),
            .CategoryBefore = values("CategoryBefore")?.ToString(),
            .CategoryAfter = values("CategoryAfter")?.ToString(),
            .ChangeReason = values("ChangeReason")?.ToString()
        }
        
        ' ä¿å­˜å‡¦ç†
        Dim service = ServiceContainer.Instance.Resolve(Of ITraceService)()
        Dim result = service.SaveTrace(dto)
        
        If result.Success Then
            MessageBox.Show("ä¿å­˜ã—ã¾ã—ãŸ")
        End If
    End Sub
    
End Class
```

---

## ğŸ¨ çŸ¢å°ç”»åƒã®æº–å‚™

### æ–¹æ³•1: ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨

```
Resources/
â””â”€â”€ arrow-right.png    (å³çŸ¢å°ã®ç”»åƒ)
```

### æ–¹æ³•2: ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§æç”»ï¼ˆæ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼‰

```vb
Private Function CreateArrowImage() As Bitmap
    Dim bmp As New Bitmap(40, 30)
    Using g As Graphics = Graphics.FromImage(bmp)
        g.SmoothingMode = Drawing2D.SmoothingMode.AntiAlias
        g.Clear(Color.Transparent)
        
        ' ã‚·ãƒ³ãƒ—ãƒ«ãªçŸ¢å°
        Using pen As New Pen(Color.Gray, 2)
            pen.EndCap = Drawing2D.LineCap.ArrowAnchor
            g.DrawLine(pen, 5, 15, 35, 15)
        End Using
    End Using
    
    Return bmp
End Function
```

### æ–¹æ³•3: ã‚ˆã‚Šå‡ã£ãŸçŸ¢å°ã‚’æç”»

```vb
Private Function CreateFancyArrowImage() As Bitmap
    Dim bmp As New Bitmap(50, 30)
    Using g As Graphics = Graphics.FromImage(bmp)
        g.SmoothingMode = Drawing2D.SmoothingMode.AntiAlias
        g.Clear(Color.Transparent)
        
        ' ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        Using brush As New Drawing2D.LinearGradientBrush(
            New Rectangle(0, 0, 50, 30),
            Color.FromArgb(33, 150, 243),  ' é–‹å§‹è‰²
            Color.FromArgb(21, 101, 192),  ' çµ‚äº†è‰²
            Drawing2D.LinearGradientMode.Horizontal)
            
            ' çŸ¢å°ã®ãƒ‘ã‚¹
            Dim arrowPath As New Drawing2D.GraphicsPath()
            Dim points As Point() = {
                New Point(5, 12),   ' å·¦ç«¯ä¸Š
                New Point(35, 12),  ' å³ç«¯ä¸Š
                New Point(35, 8),   ' çŸ¢å°ä¸Š
                New Point(45, 15),  ' çŸ¢å°å…ˆç«¯
                New Point(35, 22),  ' çŸ¢å°ä¸‹
                New Point(35, 18),  ' å³ç«¯ä¸‹
                New Point(5, 18)    ' å·¦ç«¯ä¸‹
            }
            arrowPath.AddPolygon(points)
            
            ' å¡—ã‚Šã¤ã¶ã—
            g.FillPath(brush, arrowPath)
            
            ' æ ç·š
            Using pen As New Pen(Color.FromArgb(21, 101, 192), 1)
                g.DrawPath(pen, arrowPath)
            End Using
        End Using
    End Using
    
    Return bmp
End Function
```

---

## ğŸ”§ ã•ã‚‰ã«é«˜åº¦ãªä½¿ç”¨ä¾‹

### ä¾‹2: è¤‡æ•°é …ç›®ã®çµ„ã¿åˆã‚ã›

```vb
' ä½æ‰€ï¼ˆéƒµä¾¿ç•ªå· + éƒ½é“åºœçœŒ + å¸‚åŒºç”ºæ‘ï¼‰ã‚’æ¨ªä¸¦ã³
New FormFieldDefinition With {
    .GroupName = "åŸºæœ¬æƒ…å ±",
    .FieldName = "AddressGroup",
    .LabelText = "ä½æ‰€",
    .ControlType = FieldType.CustomLayout,
    .ChildFields = New List(Of FormFieldDefinition) From {
        New FormFieldDefinition With {
            .FieldName = "PostalCode",
            .LabelText = "éƒµä¾¿ç•ªå·",
            .ControlType = FieldType.TextBox,
            .Width = 100,
            .MaxLength = 8
        },
        New FormFieldDefinition With {
            .FieldName = "Prefecture",
            .LabelText = "éƒ½é“åºœçœŒ",
            .ControlType = FieldType.ComboBox,
            .Width = 120,
            .Items = New List(Of String) From {"æ±äº¬éƒ½", "ç¥å¥ˆå·çœŒ", "å¤§é˜ªåºœ"}
        },
        New FormFieldDefinition With {
            .FieldName = "City",
            .LabelText = "å¸‚åŒºç”ºæ‘",
            .ControlType = FieldType.TextBox,
            .Width = 200
        }
    }
}
```

---

## ğŸ“Š è¦–è¦šçš„ãªã‚¤ãƒ¡ãƒ¼ã‚¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚°ãƒ«ãƒ¼ãƒ—: å¤‰æ›´å†…å®¹                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  å“å                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  å¤‰æ›´å‰     â”‚         â”‚  å¤‰æ›´å¾Œ     â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”€â”€â”€â–º   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ å•†å“A       â”‚         â”‚ å•†å“B       â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                         â”‚
â”‚  å˜ä¾¡                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚å¤‰æ›´å‰â”‚              â”‚å¤‰æ›´å¾Œâ”‚                       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¤  â”€â”€â”€â–º        â”œâ”€â”€â”€â”€â”€â”€â”¤                       â”‚
â”‚  â”‚ 1000 â”‚              â”‚ 1200 â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                         â”‚
â”‚  ã‚«ãƒ†ã‚´ãƒª                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  å¤‰æ›´å‰  â–¼ â”‚  â”€â”€â”€â–º   â”‚  å¤‰æ›´å¾Œ  â–¼ â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ é£Ÿå“        â”‚         â”‚ é£²æ–™        â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                         â”‚
â”‚  å¤‰æ›´ç†ç”± *                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ ä»•å…¥ã‚Œå…ˆå¤‰æ›´ã®ãŸã‚                       â”‚          â”‚
â”‚  â”‚                                         â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… ã¾ã¨ã‚

### å®Ÿè£…ã—ãŸã“ã¨

1. âœ… **BeforeAfterComparisonå‹** - å¤‰æ›´å‰/å¤‰æ›´å¾Œã®æ¨ªä¸¦ã³è¡¨ç¤º
2. âœ… **çŸ¢å°ç”»åƒã®æŒ¿å…¥** - è¦–è¦šçš„ãªå¤‰åŒ–ã®è¡¨ç¾
3. âœ… **æŸ”è»Ÿãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—** - TextBoxã€ComboBoxã€NumericUpDownãªã©
4. âœ… **CustomLayoutå‹** - è¤‡æ•°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è‡ªç”±ãªçµ„ã¿åˆã‚ã›

### ä½¿ã„æ–¹

```vb
' å¤‰æ›´å‰/å¤‰æ›´å¾Œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å®šç¾©
New FormFieldDefinition With {
    .FieldName = "ProductNameComparison",
    .LabelText = "å“å",
    .ControlType = FieldType.BeforeAfterComparison,
    .ComparisonConfig = New ComparisonFieldConfig With {
        .BeforeFieldName = "ProductNameBefore",
        .AfterFieldName = "ProductNameAfter",
        .BeforeLabel = "å¤‰æ›´å‰",
        .AfterLabel = "å¤‰æ›´å¾Œ",
        .ArrowImagePath = "Resources\arrow-right.png",
        .ControlWidth = 250,
        .InnerControlType = FieldType.TextBox
    }
}

' å€¤ã®å–å¾—/è¨­å®šã¯é€šå¸¸é€šã‚Š
_dynamicForm.SetFieldValue("ProductNameBefore", "å•†å“A")
_dynamicForm.SetFieldValue("ProductNameAfter", "å•†å“B")
```

ã“ã®å®Ÿè£…ã§ã€è¤‡é›‘ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚‚å‹•çš„ã«ç”Ÿæˆã§ãã¾ã™ï¼